# Cross-compilation configuration for ARM Cortex-M targets

[build]
# Default target for ARM Cortex-M4F with hardware floating point
target = "thumbv7em-none-eabihf"

[target.thumbv7em-none-eabihf]
# Cortex-M4/M7 with FPU
rustflags = [
  "-C", "link-arg=-Tmemory.x",
  "-C", "link-arg=-L.",
]
runner = "probe-run --chip STM32F407VG"

[target.thumbv7m-none-eabi]
# Cortex-M3 (no FPU)
rustflags = [
  "-C", "link-arg=-Tmemory.x",
  "-C", "link-arg=-L.",
]
runner = "qemu-system-arm -cpu cortex-m3 -machine lm3s6965evb -nographic -semihosting-config enable=on,target=native -kernel"

[target.thumbv6m-none-eabi]
# Cortex-M0/M0+ (ARMv6-M)
rustflags = [
  "-C", "link-arg=-Tmemory.x",
  "-C", "link-arg=-L.",
]

# Environment variables
[env]
DEFMT_LOG = "info"

# Unstable features for embedded development
[unstable]
build-std = ["core", "compiler_builtins"]
build-std-features = ["compiler-builtins-mem"]

# Size optimization aliases
[alias]
# Build for size
bsize = "build --release --profile size"

# Build with debug info but size optimized
bdebug = "build --profile dev"

# Check all targets
check-all = "check --target thumbv7em-none-eabihf --target thumbv7m-none-eabi --target thumbv6m-none-eabi"
