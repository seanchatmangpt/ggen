%% Basho Bench Configuration for Erlang/OTP Call Router
%% High-performance benchmark with SLA validation

%% Workload parameters
{mode, {rate, 10000}}.  %% 10,000 operations/sec target throughput
{duration, 10}.         %% 10 minutes runtime
{concurrent, 100}.      %% 100 concurrent workers

%% Driver configuration
{driver, call_router_bench}.

%% Key generation strategy
%% Generates random integers 1-1,000,000 converted to strings
{key_generator, {int_to_str, {uniform_int, 1000000}}}.

%% Value generation strategy
%% Fixed 1KB binary payload
{value_generator, {fixed_bin, 1024}}.

%% Operation mix (weighted percentages)
{operations, [
    {route_call, 70},       %% 70% - Primary routing operations
    {get_metrics, 15},      %% 15% - Metrics queries
    {get_status, 10},       %% 10% - Health checks
    {update_config, 5}      %% 5%  - Configuration updates
]}.

%% Code paths for compiled modules
{code_paths, [
    "../../_build/default/lib/*/ebin",
    "../ebin",
    "."
]}.

%% Test output directory
{test_dir, "bench_results"}.

%% Reporting configuration
{report_interval, 10}.  %% Report every 10 seconds

%% Latency tracking
{stats, [
    {percentiles, [50, 75, 90, 95, 99, 999]},  %% Track P50-P99.9
    {window_size, 10000}                        %% 10K sample window
]}.

%% SLA thresholds (microseconds)
{sla, [
    {p99_max, 1000},    %% P99 latency < 1ms
    {p95_max, 500},     %% P95 latency < 500μs
    {p50_max, 100}      %% P50 latency < 100μs
]}.

%% Connection settings (if using distributed benchmarks)
{cluster_nodes, [
    'bench@127.0.0.1'
]}.

%% Shutdown behavior
{shutdown_on_error, false}.  %% Continue on errors to measure recovery
