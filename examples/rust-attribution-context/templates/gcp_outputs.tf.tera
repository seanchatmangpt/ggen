# Generated GCP Outputs - DO NOT EDIT
#
# This file is automatically generated by ggen from ontology/infra.ttl
# To make changes, edit the ontology and run: ggen sync

{% for row in sparql_results -%}
{%- set service_name = row["?serviceName"] | default(value="attribution-service") -%}

# Cloud Run Service Outputs
output "cloud_run_service_url" {
  description = "URL of the Cloud Run service"
  value       = google_cloud_run_v2_service.{{ service_name | replace(from="-", to="_") }}.uri
}

output "cloud_run_service_name" {
  description = "Name of the Cloud Run service"
  value       = google_cloud_run_v2_service.{{ service_name | replace(from="-", to="_") }}.name
}

output "cloud_run_service_location" {
  description = "Location of the Cloud Run service"
  value       = google_cloud_run_v2_service.{{ service_name | replace(from="-", to="_") }}.location
}

output "cloud_run_service_account_email" {
  description = "Service account email for Cloud Run"
  value       = google_service_account.{{ service_name | replace(from="-", to="_") }}_sa.email
}

{% endfor %}

# Cloud SQL Outputs
output "cloudsql_instance_name" {
  description = "Name of the Cloud SQL instance"
  value       = google_sql_database_instance.attribution_event_store.name
}

output "cloudsql_connection_name" {
  description = "Connection name for Cloud SQL instance"
  value       = google_sql_database_instance.attribution_event_store.connection_name
}

output "cloudsql_private_ip" {
  description = "Private IP address of Cloud SQL instance"
  value       = google_sql_database_instance.attribution_event_store.private_ip_address
  sensitive   = true
}

output "cloudsql_database_name" {
  description = "Name of the event store database"
  value       = google_sql_database.event_store_db.name
}

output "cloudsql_replica_connection_name" {
  description = "Connection name for Cloud SQL read replica"
  value       = google_sql_database_instance.attribution_event_store_replica.connection_name
}

# Cloud Storage Outputs
output "static_content_bucket_name" {
  description = "Name of the static content bucket"
  value       = google_storage_bucket.attribution_static_content.name
}

output "static_content_bucket_url" {
  description = "URL of the static content bucket"
  value       = google_storage_bucket.attribution_static_content.url
}

output "cdn_ip_address" {
  description = "Global IP address for CDN"
  value       = google_compute_global_address.attribution_static_content_cdn.address
}

output "cdn_url_map" {
  description = "URL map for CDN"
  value       = google_compute_url_map.attribution_static_content_cdn.self_link
}

output "backup_bucket_name" {
  description = "Name of the event store backup bucket"
  value       = google_storage_bucket.event_store_backups.name
}

output "log_archive_bucket_name" {
  description = "Name of the log archive bucket"
  value       = google_storage_bucket.log_archive.name
}

# Networking Outputs
output "vpc_network_name" {
  description = "Name of the VPC network"
  value       = google_compute_network.vpc.name
}

output "vpc_network_id" {
  description = "ID of the VPC network"
  value       = google_compute_network.vpc.id
}

output "vpc_network_self_link" {
  description = "Self-link of the VPC network"
  value       = google_compute_network.vpc.self_link
}

output "public_subnet_name" {
  description = "Name of the public subnet"
  value       = google_compute_subnetwork.public.name
}

output "public_subnet_cidr" {
  description = "CIDR range of the public subnet"
  value       = google_compute_subnetwork.public.ip_cidr_range
}

output "private_subnet_name" {
  description = "Name of the private subnet"
  value       = google_compute_subnetwork.private.name
}

output "private_subnet_cidr" {
  description = "CIDR range of the private subnet"
  value       = google_compute_subnetwork.private.ip_cidr_range
}

output "vpc_connector_name" {
  description = "Name of the VPC Access Connector"
  value       = google_vpc_access_connector.connector.name
}

output "cloud_armor_policy_id" {
  description = "ID of the Cloud Armor security policy"
  value       = google_compute_security_policy.cloud_armor_policy.id
}

output "cloud_nat_name" {
  description = "Name of the Cloud NAT"
  value       = google_compute_router_nat.nat.name
}

# DNS Outputs
output "dns_zone_name" {
  description = "Name of the DNS managed zone"
  value       = google_dns_managed_zone.attribution_zone.name
}

output "dns_zone_nameservers" {
  description = "Name servers for the DNS zone"
  value       = google_dns_managed_zone.attribution_zone.name_servers
}

output "api_domain" {
  description = "API domain name"
  value       = "api.${var.domain_name}"
}

output "static_domain" {
  description = "Static content domain name"
  value       = "static.${var.domain_name}"
}

# Monitoring Outputs
output "uptime_check_id" {
  description = "ID of the uptime check"
  value       = google_monitoring_uptime_check_config.attribution_service_uptime.uptime_check_id
}

output "monitoring_dashboard_url" {
  description = "URL of the Cloud Monitoring dashboard"
  value       = "https://console.cloud.google.com/monitoring/dashboards/custom/${google_monitoring_dashboard.attribution_service_dashboard.id}?project=${var.project_id}"
}

output "log_sink_name" {
  description = "Name of the log sink"
  value       = google_logging_project_sink.attribution_logs.name
}

output "log_sink_writer_identity" {
  description = "Writer identity for the log sink"
  value       = google_logging_project_sink.attribution_logs.writer_identity
  sensitive   = true
}

# Security Outputs
output "kms_keyring_name" {
  description = "Name of the KMS keyring"
  value       = google_kms_key_ring.event_store.name
}

output "kms_crypto_key_name" {
  description = "Name of the KMS crypto key"
  value       = google_kms_crypto_key.event_store_key.name
}

output "secret_manager_db_secret_id" {
  description = "Secret Manager secret ID for database connection"
  value       = google_secret_manager_secret.db_connection_string.secret_id
}

output "cicd_service_account_email" {
  description = "CI/CD service account email"
  value       = google_service_account.cicd_deployer.email
}

output "db_migrator_service_account_email" {
  description = "Database migrator service account email"
  value       = google_service_account.db_migrator.email
}

output "artifact_registry_repository_id" {
  description = "Artifact Registry repository ID"
  value       = google_artifact_registry_repository.container_images.repository_id
}

output "artifact_registry_repository_url" {
  description = "Artifact Registry repository URL"
  value       = "${var.region}-docker.pkg.dev/${var.project_id}/${google_artifact_registry_repository.container_images.repository_id}"
}

# Deployment Instructions
output "deployment_instructions" {
  description = "Instructions for deploying the application"
  value = <<-EOT
    # Deploy to Cloud Run:

    1. Build and push container image:
       docker build -t ${var.region}-docker.pkg.dev/${var.project_id}/${google_artifact_registry_repository.container_images.repository_id}/attribution-service:latest .
       docker push ${var.region}-docker.pkg.dev/${var.project_id}/${google_artifact_registry_repository.container_images.repository_id}/attribution-service:latest

    2. Deploy to Cloud Run:
       gcloud run deploy ${google_cloud_run_v2_service.attribution_service.name} \
         --image ${var.region}-docker.pkg.dev/${var.project_id}/${google_artifact_registry_repository.container_images.repository_id}/attribution-service:latest \
         --region ${google_cloud_run_v2_service.attribution_service.location} \
         --platform managed

    3. Configure custom domain:
       gcloud beta run domain-mappings create --service ${google_cloud_run_v2_service.attribution_service.name} --domain api.${var.domain_name} --region ${google_cloud_run_v2_service.attribution_service.location}

    4. Update DNS records:
       Add A records pointing to:
       - api.${var.domain_name} -> ${google_compute_global_address.cloud_run_ip.address}
       - static.${var.domain_name} -> ${google_compute_global_address.attribution_static_content_cdn.address}

    5. Run database migrations:
       gcloud run jobs execute db-migrate --region ${var.region}
  EOT
}

# Cost Estimation
output "estimated_monthly_cost" {
  description = "Estimated monthly cost breakdown (approximate)"
  value = <<-EOT
    Estimated Monthly Costs (US Central1):

    Cloud Run (2 vCPU, 2GB, avg 5 instances):      $50-100/month
    Cloud SQL (db-custom-2-7680, Regional):        $150-200/month
    Cloud SQL Read Replica:                        $150-200/month
    Cloud Storage (100GB + requests):              $5-10/month
    Cloud CDN (1TB egress):                        $80-120/month
    Cloud Monitoring/Logging:                      $20-50/month
    VPC (NAT gateway, connector):                  $40-60/month
    Secret Manager:                                $1-5/month
    KMS (key storage + operations):                $1-5/month

    Total Estimated:                               $497-850/month

    Note: Actual costs depend on traffic, storage, and feature usage.
    Enable budget alerts in GCP Console for cost control.
  EOT
}
