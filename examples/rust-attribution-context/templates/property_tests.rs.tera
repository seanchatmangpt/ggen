//! Generated Property Tests - DO NOT EDIT
//!
//! This file is automatically generated by ggen from ontology/entities.ttl
//! To make changes, edit the ontology and run: ggen sync

use proptest::prelude::*;
use uuid::Uuid;
use chrono::Utc;

use world::*;

{% set current_entity = "" -%}
{% for row in sparql_results -%}
  {%- set entity_name = row["?entityName"] -%}

  {%- if entity_name != current_entity -%}
    {%- if current_entity != "" %}
    }
}
    {% endif -%}

// Property test strategy for {{ entity_name }}
prop_compose! {
    fn arb_{{ entity_name | lower }}()(
    {%- set current_entity = entity_name -%}
  {%- endif -%}

  {%- if row["?fieldType"] == "Uuid" %}
        {{ row["?fieldName"] }} in prop::strategy::Just(Uuid::new_v4()),
  {%- elif row["?fieldType"] == "String" %}
        {{ row["?fieldName"] }} in "[a-zA-Z0-9 ]{1,100}",
  {%- elif row["?fieldType"] == "Decimal" %}
        {{ row["?fieldName"] }} in 0.0..1000000.0f64,
  {%- elif row["?fieldType"] == "DateTime" %}
        {{ row["?fieldName"] }} in prop::strategy::Just(Utc::now()),
  {%- elif row["?fieldType"] == "i64" %}
        {{ row["?fieldName"] }} in 0i64..1000000i64,
  {%- elif row["?fieldType"] == "bool" %}
        {{ row["?fieldName"] }} in prop::bool::ANY,
  {%- else %}
        {{ row["?fieldName"] }} in prop::strategy::Just(Default::default()),
  {%- endif -%}
{%- endfor %}
    ) -> {{ current_entity }} {
        {{ current_entity }} {
{%- for row in sparql_results -%}
  {%- if row["?entityName"] == current_entity %}
            {{ row["?fieldName"] }},
  {%- endif -%}
{%- endfor %}
        }
    }
}

proptest! {
    #[test]
    fn test_{{ current_entity | lower }}_serialization_roundtrip(entity in arb_{{ current_entity | lower }}()) {
        // Serialize to JSON
        let json = serde_json::to_string(&entity).unwrap();

        // Deserialize back
        let deserialized: {{ current_entity }} = serde_json::from_str(&json).unwrap();

        // Should be identical
        assert_eq!(entity, deserialized);
    }
}
