%%{init: {'theme':'base'}}%%
graph TB
    %% Generated C4 Container Diagram - DO NOT EDIT
    %% This file is automatically generated by ggen from ontology/
    %% To make changes, edit the ontology and run: ggen sync

    classDef container fill:#1168bd,stroke:#0b4884,color:#ffffff
    classDef database fill:#ff6b6b,stroke:#cc5555,color:#ffffff

{% set context_name = sparql_results[0]["?contextName"] | default(value="Attribution") -%}

    subgraph "{{ context_name }} System"
        API["API Layer
        ---
        Axum HTTP Server
        Handles commands"]:::container

        WriteModel["Write Model
        ---
        Aggregates + Handlers
        CQRS command side"]:::container

        EventStore["Event Store
        ---
        Durable event log
        Source of truth"]:::database

        ReadModel["Read Model
        ---
        Projections
        CQRS query side"]:::database

{% for row in sparql_results -%}
{%- if row["?aggregateName"] %}
        Agg_{{ row["?aggregateName"] }}["{{ row["?aggregateName"] }}
        ---
        Aggregate Root"]:::container
{% endif -%}
{%- endfor %}
    end

    API -->|"Executes"| WriteModel
    WriteModel -->|"Persists"| EventStore
    EventStore -->|"Projects"| ReadModel
    API -->|"Queries"| ReadModel

{% for row in sparql_results -%}
{%- if row["?aggregateName"] %}
    WriteModel -->|"Contains"| Agg_{{ row["?aggregateName"] }}
{% endif -%}
{%- endfor %}
