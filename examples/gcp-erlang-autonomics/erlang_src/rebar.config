%% Rebar3 configuration for observability module

{erl_opts, [
    debug_info,
    warnings_as_errors,
    {parse_transform, lager_transform}
]}.

{deps, [
    %% Logging
    {lager, "3.9.2"},
    {logger, "0.8.0"},

    %% Profiling and debugging
    {eprof, "0.2.5"},

    %% Tracing helpers
    {redbug, "1.2.1"},

    %% HTTP client for GCP APIs
    {httpc, "1.2.0"},
    {hackney, "1.18.1"},

    %% JSON support
    {jiffy, "1.1.1"},
    {jsx, "3.1.0"},

    %% Testing
    {eunit, "2.3.7"},
    {ct, "1.18.0"},

    %% Utility libraries
    {sync, "0.8.2"},
    {unicode, "1.2.3"}
]}.

%% Build profiles
{profiles, [
    {dev, [
        {erl_opts, [
            debug_info,
            {parse_transform, lager_transform}
        ]},
        {relx, [
            {dev_mode, true},
            {include_erts, false},
            {system_libs, true}
        ]}
    ]},

    {prod, [
        {erl_opts, [
            {parse_transform, lager_transform},
            warn_missing_spec,
            warn_missing_spec_all
        ]},
        {relx, [
            {dev_mode, false},
            {include_erts, true},
            {system_libs, false}
        ]}
    ]},

    {test, [
        {erl_opts, [
            debug_info,
            {parse_transform, lager_transform}
        ]}
    ]}
]}.

%% EUnit Options
{eunit_opts, [
    verbose,
    {skip_deps, true},
    {test_first_files, [
        "metrics_collector",
        "trace_handler",
        "profiler",
        "alert_manager",
        "observer_ui"
    ]}
]}.

%% Common test options
{ct_opts, [
    {sys_config, ["sys.config"]},
    {config, ["config/test.config"]}
]}.

%% Relx configuration (for creating releases)
{relx, [
    {release, {observability, "1.0.0"}, [
        kernel,
        stdlib,
        sasl,
        lager,
        observability
    ]},

    {sys_config, "sys.config"},
    {vm_args, "vm.args"},

    {overlay, [
        {mkdir, "log"},
        {mkdir, "profiles"},
        {mkdir, "observer_dumps"},
        {copy, "priv/snippets", "snippets"}
    ]}
]}.

%% Plugins
{plugins, [
    rebar3_lint,
    rebar3_format
]}.

%% Format options
{format, [
    {formatter, rebar3_format},
    {formatter_config, [
        {space_around_nested_parentheses, false}
    ]}
]}.
