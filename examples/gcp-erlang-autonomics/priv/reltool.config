{sys, [
  {lib_dirs, ["/opt/erlang/lib", "deps"]},
  {erts, [{mod_cond, derived}, {app_file, strip}]},
  {app_file, strip},
  {rel, "erlang-autonomics", "1.0.0", [
    kernel,
    stdlib,
    sasl,
    runtime_tools,
    observer,
    wx,
    crypto,
    ssl,
    inets,
    httpc,
    xmerl,
    public_key,

    %% Marketplace Governors (one per SKU)
    cost_guard_governor,
    rollback_guard_governor,
    backlog_valve_governor,

    %% Shared infrastructure
    erlang_autonomics
  ]},

  {rel, "erlang-autonomics-start-clean", "1.0.0", [
    kernel,
    stdlib
  ]},

  {boot_rel, "erlang-autonomics"},
  {profile, embedded},
  {incl_cond, derived},

  {excl_apps, [
    debugger,
    dialyzer,
    edoc,
    erl_docgen,
    erts,
    et,
    eunit,
    gs,
    hipe,
    jinterface,
    megaco,
    observer_cli,
    odbc,
    orber,
    parsetools,
    reltool,
    snmp,
    ssh,
    syntax_tools,
    test_server,
    tools,
    typer,
    webtool,
    xmerl
  ]},

  {excl_modules, []},

  {incl_sys_filters, [
    "^bin/(erl|run_erl)$",
    "^erts.*/bin/(erl|run_erl|escript)$"
  ]},

  {excl_sys_filters, [
    "^bin/.*",
    "^erts.*/bin/(dialyzer|typer|escript|run_erl)$",
    "^erts.*/lib"
  ]},

  {excl_app_filters, ["^ebin/.*\\.app(\\.src)?$"]},

  {copy_file_filters, [
    ".so$",
    ".beam$",
    ".plt$",
    ".app(\\.src)?$",
    ".erl$",
    ".hrl$",
    ".config$",
    "README(.md)?$",
    "LICENSE",
    "CHANGELOG(.md)?$"
  ]},

  {create_dir, ["log/sasl"]},

  {overlay, [
    {mkdir, "etc"},
    {copy, "priv/sys.config", "etc/sys.config"},
    {copy, "priv/vm.args", "etc/vm.args"},
    {mkdir, "var/log"},
    {mkdir, "var/log/sasl"}
  ]},

  {target_dir, "_build/default/rel/erlang-autonomics"},
  {overwrite, true}
]}.
