# Lifecycle Configuration for advanced-lifecycle-demo
# Multi-crate workspace orchestration example

[env]
RUST_LOG = "debug"
CARGO_MAKE_SKIP_GIT_SKIP_ALLOWED_PUSH_BRANCH_CHECK = true

[config]
skip_core_tasks = false
default_to_shell = false

# ==============================================================================
# CORE LIFECYCLE TASKS
# ==============================================================================

[tasks.check]
description = "Fast compilation check (< 5s)"
command = "cargo"
args = ["check", "--all"]
dependencies = []

[tasks.fmt]
description = "Format code using rustfmt"
command = "cargo"
args = ["fmt", "--all"]
dependencies = []

[tasks.lint]
description = "Run clippy linter"
command = "cargo"
args = ["clippy", "--all-targets", "--", "-D", "warnings"]
dependencies = []

[tasks.test-unit]
description = "Run unit tests (< 10s)"
command = "cargo"
args = ["test", "--lib", "--all"]
dependencies = ["check"]

[tasks.test]
description = "Run all tests (< 30s)"
command = "cargo"
args = ["test", "--all"]
dependencies = ["check"]

[tasks.pre-commit]
description = "Full validation before commit"
script = """
cargo fmt --all
cargo clippy --all-targets -- -D warnings
cargo test --all
"""

[tasks.ci]
description = "Full CI pipeline"
script = """
cargo check --all
cargo fmt --check
cargo clippy --all-targets -- -D warnings
cargo test --all
"""

# ==============================================================================
# BUILD & RUN
# ==============================================================================

[tasks.build]
description = "Build the entire workspace"
command = "cargo"
args = ["build", "--workspace", "--release"]
dependencies = ["check"]

[tasks.run]
description = "Run the CLI demo"
command = "cargo"
args = ["run", "--bin", "lifecycle-demo", "--", "demo"]
dependencies = ["build"]

# ==============================================================================
# HELP
# ==============================================================================

[tasks.help]
description = "Show available tasks"
script = """
echo "Advanced Lifecycle Demo - Available Tasks:"
echo ""
echo "Build & Check:"
echo "  cargo make check        - Fast compilation check"
echo "  cargo make build        - Build all crates"
echo ""
echo "Testing & Quality:"
echo "  cargo make test         - Run all tests"
echo "  cargo make fmt          - Format code"
echo "  cargo make lint         - Run clippy"
echo "  cargo make pre-commit   - Full validation"
echo ""
echo "Demo:"
echo "  cargo make run          - Run the demo"
echo ""
echo "CLI Commands:"
echo "  cargo run --bin lifecycle-demo -- create --name 'Job' --tasks 3"
echo "  cargo run --bin lifecycle-demo -- list"
echo "  cargo run --bin lifecycle-demo -- demo"
"""

[tasks.default]
command = "cargo"
args = ["make", "help"]
