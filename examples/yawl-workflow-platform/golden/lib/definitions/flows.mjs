/**
 * @fileoverview YAWL Flow Definitions
 * Generated from RDF ontology specifications
 * DO NOT EDIT - auto-generated by ggen sync
 * @module flows
 */

import { z } from 'zod';

export const FlowDefinitionSchema = z.object({
  flowId: z.string().optional(),
  sourceTaskId: z.string(),
  targetTaskId: z.string(),
  condition: z.string().optional(),
  priority: z.number().int().default(1),
  isDefault: z.boolean().default(false),
});

// -----------------------------------------------------------------------------
// CI/CD Pipeline Flows
// -----------------------------------------------------------------------------

export const CICD_PIPELINE_FLOWS = [
  {
    flowId: 'checkout-code-build-project',
    sourceTaskId: 'checkout-code',
    targetTaskId: 'build-project',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'build-project-run-unit-tests',
    sourceTaskId: 'build-project',
    targetTaskId: 'run-unit-tests',
    condition: 'testConfig.unit == true',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'build-project-run-integration-tests',
    sourceTaskId: 'build-project',
    targetTaskId: 'run-integration-tests',
    condition: 'testConfig.integration == true',
    priority: 2,
    isDefault: false,
  },
  {
    flowId: 'build-project-run-e2e-tests',
    sourceTaskId: 'build-project',
    targetTaskId: 'run-e2e-tests',
    condition: 'testConfig.e2e == true',
    priority: 3,
    isDefault: false,
  },
  {
    flowId: 'run-unit-tests-merge-results',
    sourceTaskId: 'run-unit-tests',
    targetTaskId: 'merge-results',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'run-integration-tests-merge-results',
    sourceTaskId: 'run-integration-tests',
    targetTaskId: 'merge-results',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'run-e2e-tests-merge-results',
    sourceTaskId: 'run-e2e-tests',
    targetTaskId: 'merge-results',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'merge-results-deploy',
    sourceTaskId: 'merge-results',
    targetTaskId: 'deploy',
    condition: 'allTestsPassed == true',
    priority: 1,
    isDefault: true,
  },
];

// -----------------------------------------------------------------------------
// Document Approval Flows
// -----------------------------------------------------------------------------

export const DOCUMENT_APPROVAL_FLOWS = [
  {
    flowId: 'submit-document-review-document',
    sourceTaskId: 'submit-document',
    targetTaskId: 'review-document',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'review-document-approve-document',
    sourceTaskId: 'review-document',
    targetTaskId: 'approve-document',
    condition: 'decision == \'approved\'',
    priority: 1,
    isDefault: false,
  },
  {
    flowId: 'review-document-reject-document',
    sourceTaskId: 'review-document',
    targetTaskId: 'reject-document',
    condition: 'decision == \'rejected\'',
    priority: 2,
    isDefault: true,
  },
  {
    flowId: 'approve-document-notify-submitter',
    sourceTaskId: 'approve-document',
    targetTaskId: 'notify-submitter',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'reject-document-notify-submitter',
    sourceTaskId: 'reject-document',
    targetTaskId: 'notify-submitter',
    priority: 1,
    isDefault: true,
  },
];

// -----------------------------------------------------------------------------
// HR Onboarding Flows
// -----------------------------------------------------------------------------

export const HR_ONBOARDING_FLOWS = [
  {
    flowId: 'create-employee-record-assign-training',
    sourceTaskId: 'create-employee-record',
    targetTaskId: 'assign-training',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'assign-training-complete-training-module',
    sourceTaskId: 'assign-training',
    targetTaskId: 'complete-training-module',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'complete-training-module-setup-workstation',
    sourceTaskId: 'complete-training-module',
    targetTaskId: 'setup-workstation',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'setup-workstation-finalize-onboarding',
    sourceTaskId: 'setup-workstation',
    targetTaskId: 'finalize-onboarding',
    priority: 1,
    isDefault: true,
  },
];

// -----------------------------------------------------------------------------
// Incident Management Flows
// -----------------------------------------------------------------------------

export const INCIDENT_MANAGEMENT_FLOWS = [
  {
    flowId: 'log-incident-classify-incident',
    sourceTaskId: 'log-incident',
    targetTaskId: 'classify-incident',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'classify-incident-assign-technician',
    sourceTaskId: 'classify-incident',
    targetTaskId: 'assign-technician',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'assign-technician-resolve-incident',
    sourceTaskId: 'assign-technician',
    targetTaskId: 'resolve-incident',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'resolve-incident-verify-resolution',
    sourceTaskId: 'resolve-incident',
    targetTaskId: 'verify-resolution',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'verify-resolution-close-incident',
    sourceTaskId: 'verify-resolution',
    targetTaskId: 'close-incident',
    priority: 1,
    isDefault: true,
  },
];

// -----------------------------------------------------------------------------
// Order Processing Flows
// -----------------------------------------------------------------------------

export const ORDER_PROCESSING_FLOWS = [
  {
    flowId: 'receive-order-verify-payment',
    sourceTaskId: 'receive-order',
    targetTaskId: 'verify-payment',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'receive-order-check-inventory',
    sourceTaskId: 'receive-order',
    targetTaskId: 'check-inventory',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'verify-payment-fulfill-order',
    sourceTaskId: 'verify-payment',
    targetTaskId: 'fulfill-order',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'check-inventory-fulfill-order',
    sourceTaskId: 'check-inventory',
    targetTaskId: 'fulfill-order',
    priority: 1,
    isDefault: true,
  },
  {
    flowId: 'fulfill-order-ship-order',
    sourceTaskId: 'fulfill-order',
    targetTaskId: 'ship-order',
    priority: 1,
    isDefault: true,
  },
];

// =============================================================================
// Flow Registry
// =============================================================================

export class FlowRegistry {
  /** @type {Map<string, Array>} */
  #flows = new Map();

  constructor() {
    this.#flows.set('cicd-pipeline', CICD_PIPELINE_FLOWS);
    this.#flows.set('document-approval', DOCUMENT_APPROVAL_FLOWS);
    this.#flows.set('hr-onboarding', HR_ONBOARDING_FLOWS);
    this.#flows.set('incident-management', INCIDENT_MANAGEMENT_FLOWS);
    this.#flows.set('order-processing', ORDER_PROCESSING_FLOWS);
  }

  /**
   * @param {string} specId
   * @returns {Array}
   */
  getFlows(specId) {
    return this.#flows.get(specId) || [];
  }

  /**
   * @param {string} specId
   * @param {string} taskId
   * @returns {Array}
   */
  getOutgoingFlows(specId, taskId) {
    return this.getFlows(specId).filter(f => f.sourceTaskId === taskId);
  }

  /**
   * @param {string} specId
   * @param {string} taskId
   * @returns {Array}
   */
  getIncomingFlows(specId, taskId) {
    return this.getFlows(specId).filter(f => f.targetTaskId === taskId);
  }
}

export const flowRegistry = new FlowRegistry();
