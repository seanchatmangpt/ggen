/**
 * @fileoverview YAWL Task Definitions
 * Generated from RDF ontology specifications
 * DO NOT EDIT - auto-generated by ggen sync
 * @module tasks
 */

import { z } from 'zod';

// =============================================================================
// Task Kind Enumeration
// =============================================================================

export const TaskKind = {
  ATOMIC: 'atomic',
  COMPOSITE: 'composite',
  MULTIPLE_INSTANCE: 'multiple-instance',
  AUTOMATED: 'automated',
  MANUAL: 'manual',
};

export const TaskKindSchema = z.enum(['atomic', 'composite', 'multiple-instance', 'automated', 'manual']);

// =============================================================================
// Split/Join Behavior Enumerations
// =============================================================================

export const SplitBehavior = {
  XOR: 'XOR',
  AND: 'AND',
  OR: 'OR',
};

export const SplitBehaviorSchema = z.enum(['XOR', 'AND', 'OR']);

export const JoinBehavior = {
  XOR: 'XOR',
  AND: 'AND',
  OR: 'OR',
};

export const JoinBehaviorSchema = z.enum(['XOR', 'AND', 'OR']);

// =============================================================================
// Multiple Instance Configuration
// =============================================================================

export const MultipleInstanceConfigSchema = z.object({
  minimum: z.number().int().min(1),
  maximum: z.number().int().min(1),
  threshold: z.number().int().min(1),
  creationMode: z.enum(['static', 'dynamic']),
});

// =============================================================================
// Task Definition Schema
// =============================================================================

export const TaskDefinitionSchema = z.object({
  taskId: z.string().min(1),
  taskName: z.string().min(1),
  taskKind: TaskKindSchema,
  description: z.string().optional(),
  splitBehavior: SplitBehaviorSchema.optional().default('XOR'),
  joinBehavior: JoinBehaviorSchema.optional().default('XOR'),
  miConfig: MultipleInstanceConfigSchema.optional(),
  decomposesTo: z.string().optional(),
  cancellationSet: z.array(z.string()).optional(),
  inputParameters: z.record(z.unknown()).optional(),
  outputParameters: z.record(z.unknown()).optional(),
});

// =============================================================================
// Generated Task Definitions by Workflow
// =============================================================================

// -----------------------------------------------------------------------------
// Cicd Pipeline Tasks
// -----------------------------------------------------------------------------

export const CICD_PIPELINE_TASKS = [
  {
    taskId: 'build-project',
    taskName: 'Build Project',
    taskKind: 'automated',
    description: 'Compile and build the project',
    splitBehavior: 'OR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'checkout-code',
    taskName: 'Checkout Code',
    taskKind: 'automated',
    description: 'Checkout source code from repository',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'deploy',
    taskName: 'Deploy to Environment',
    taskKind: 'automated',
    description: 'Deploy build to target environment',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'merge-results',
    taskName: 'Merge Test Results',
    taskKind: 'automated',
    description: 'Aggregate test results from all suites',
    splitBehavior: 'XOR',
    joinBehavior: 'OR',
  },
  {
    taskId: 'run-e2e-tests',
    taskName: 'Run E2E Tests',
    taskKind: 'automated',
    description: 'Execute end-to-end test suite',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'run-integration-tests',
    taskName: 'Run Integration Tests',
    taskKind: 'automated',
    description: 'Execute integration test suite',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'run-unit-tests',
    taskName: 'Run Unit Tests',
    taskKind: 'automated',
    description: 'Execute unit test suite',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
];

// -----------------------------------------------------------------------------
// Document Approval Tasks
// -----------------------------------------------------------------------------

export const DOCUMENT_APPROVAL_TASKS = [
  {
    taskId: 'approve-document',
    taskName: 'Approve Document',
    taskKind: 'automated',
    description: 'System marks document as approved',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'notify-submitter',
    taskName: 'Notify Submitter',
    taskKind: 'automated',
    description: 'System sends notification to document submitter',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'reject-document',
    taskName: 'Reject Document',
    taskKind: 'automated',
    description: 'System marks document as rejected',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'review-document',
    taskName: 'Review Document',
    taskKind: 'manual',
    description: 'Reviewer examines submitted document',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'submit-document',
    taskName: 'Submit Document',
    taskKind: 'manual',
    description: 'User submits document for approval',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
];

// -----------------------------------------------------------------------------
// Hr Onboarding Tasks
// -----------------------------------------------------------------------------

export const HR_ONBOARDING_TASKS = [
  {
    taskId: 'assign-training',
    taskName: 'Assign Training Modules',
    taskKind: 'automated',
    description: 'Assign required training based on role',
    splitBehavior: 'AND',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'complete-training-module',
    taskName: 'Complete Training Module',
    taskKind: 'multiple-instance',
    description: 'Complete individual training module (multiple instances)',
    splitBehavior: 'XOR',
    joinBehavior: 'AND',
    miConfig: {
      minimum: 1,
      maximum: 10,
      threshold: 3,
      creationMode: 'dynamic',
    },
  },
  {
    taskId: 'create-employee-record',
    taskName: 'Create Employee Record',
    taskKind: 'automated',
    description: 'Create employee in HR system',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'finalize-onboarding',
    taskName: 'Finalize Onboarding',
    taskKind: 'automated',
    description: 'Complete onboarding process',
    splitBehavior: 'XOR',
    joinBehavior: 'AND',
  },
  {
    taskId: 'setup-workstation',
    taskName: 'Setup Workstation',
    taskKind: 'manual',
    description: 'IT sets up employee workstation',
    splitBehavior: 'XOR',
    joinBehavior: 'AND',
  },
];

// -----------------------------------------------------------------------------
// Incident Management Tasks
// -----------------------------------------------------------------------------

export const INCIDENT_MANAGEMENT_TASKS = [
  {
    taskId: 'assign-technician',
    taskName: 'Assign Technician',
    taskKind: 'manual',
    description: 'Assign available technician based on skills',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'classify-incident',
    taskName: 'Classify Incident',
    taskKind: 'automated',
    description: 'Auto-classify incident severity and type',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'close-incident',
    taskName: 'Close Incident',
    taskKind: 'automated',
    description: 'System closes incident ticket',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'log-incident',
    taskName: 'Log Incident',
    taskKind: 'automated',
    description: 'Create incident ticket in system',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'resolve-incident',
    taskName: 'Resolve Incident',
    taskKind: 'manual',
    description: 'Technician resolves the incident',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'verify-resolution',
    taskName: 'Verify Resolution',
    taskKind: 'manual',
    description: 'User verifies incident is resolved',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
];

// -----------------------------------------------------------------------------
// Order Processing Tasks
// -----------------------------------------------------------------------------

export const ORDER_PROCESSING_TASKS = [
  {
    taskId: 'check-inventory',
    taskName: 'Check Inventory',
    taskKind: 'automated',
    description: 'Warehouse inventory check',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'fulfill-order',
    taskName: 'Fulfill Order',
    taskKind: 'manual',
    description: 'Warehouse picks and packs order',
    splitBehavior: 'XOR',
    joinBehavior: 'AND',
  },
  {
    taskId: 'receive-order',
    taskName: 'Receive Order',
    taskKind: 'automated',
    description: 'System receives and validates order',
    splitBehavior: 'AND',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'ship-order',
    taskName: 'Ship Order',
    taskKind: 'automated',
    description: 'Generate shipping label and dispatch',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
  {
    taskId: 'verify-payment',
    taskName: 'Verify Payment',
    taskKind: 'automated',
    description: 'Payment gateway verification',
    splitBehavior: 'XOR',
    joinBehavior: 'XOR',
  },
];

// =============================================================================
// Task Registry
// =============================================================================

export class TaskRegistry {
  /** @type {Map<string, Map<string, object>>} */
  #tasks = new Map();

  constructor() {
    this.#registerWorkflowTasks();
  }

  #registerWorkflowTasks() {
    this.#registerTasks('cicd-pipeline', CICD_PIPELINE_TASKS);
    this.#registerTasks('document-approval', DOCUMENT_APPROVAL_TASKS);
    this.#registerTasks('hr-onboarding', HR_ONBOARDING_TASKS);
    this.#registerTasks('incident-management', INCIDENT_MANAGEMENT_TASKS);
    this.#registerTasks('order-processing', ORDER_PROCESSING_TASKS);
  }

  /**
   * @param {string} specId
   * @param {Array} tasks
   */
  #registerTasks(specId, tasks) {
    const taskMap = new Map();
    for (const task of tasks) {
      taskMap.set(task.taskId, task);
    }
    this.#tasks.set(specId, taskMap);
  }

  /**
   * Get task definition by workflow and task ID
   * @param {string} specId
   * @param {string} taskId
   * @returns {object|undefined}
   */
  getTask(specId, taskId) {
    return this.#tasks.get(specId)?.get(taskId);
  }

  /**
   * Get all tasks for a workflow
   * @param {string} specId
   * @returns {Array}
   */
  getWorkflowTasks(specId) {
    const taskMap = this.#tasks.get(specId);
    return taskMap ? Array.from(taskMap.values()) : [];
  }

  /**
   * Get all registered workflow IDs
   * @returns {string[]}
   */
  getWorkflowIds() {
    return Array.from(this.#tasks.keys());
  }

  /**
   * Validate task definition
   * @param {unknown} task
   * @returns {object}
   */
  validateTask(task) {
    return TaskDefinitionSchema.parse(task);
  }
}

// =============================================================================
// Singleton Instance
// =============================================================================

export const taskRegistry = new TaskRegistry();

// =============================================================================
// Helper Functions
// =============================================================================

/**
 * Check if a task is a multiple instance task
 * @param {object} task
 * @returns {boolean}
 */
export function isMultipleInstanceTask(task) {
  return task.taskKind === 'multiple-instance' && !!task.miConfig;
}

/**
 * Check if a task requires human interaction
 * @param {object} task
 * @returns {boolean}
 */
export function isManualTask(task) {
  return task.taskKind === 'manual';
}

/**
 * Check if a task is automated
 * @param {object} task
 * @returns {boolean}
 */
export function isAutomatedTask(task) {
  return task.taskKind === 'automated';
}

/**
 * Get the split pattern name (Van der Aalst pattern)
 * @param {string} behavior
 * @returns {string}
 */
export function getSplitPatternName(behavior) {
  switch (behavior) {
    case 'XOR': return 'WP4: Exclusive Choice';
    case 'AND': return 'WP2: Parallel Split';
    case 'OR': return 'WP6: Multi-Choice';
    default: return 'Unknown';
  }
}

/**
 * Get the join pattern name (Van der Aalst pattern)
 * @param {string} behavior
 * @returns {string}
 */
export function getJoinPatternName(behavior) {
  switch (behavior) {
    case 'XOR': return 'WP5: Simple Merge';
    case 'AND': return 'WP3: Synchronization';
    case 'OR': return 'WP7: Structured Synchronizing Merge';
    default: return 'Unknown';
  }
}
