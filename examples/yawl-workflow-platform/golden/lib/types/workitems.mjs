/**
 * @fileoverview YAWL Work Item Types
 * DO NOT EDIT - auto-generated by ggen sync
 * @module workitems
 */

import { z } from 'zod';

export const WorkItemStatus = {
  ALLOCATED: 'allocated',
  CANCELLED: 'cancelled',
  COMPLETED: 'completed',
  ENABLED: 'enabled',
  FAILED: 'failed',
  FIRED: 'fired',
  STARTED: 'started',
  SUSPENDED: 'suspended',
};

export const WorkItemStatusSchema = z.enum([
  'allocated',
  'cancelled',
  'completed',
  'enabled',
  'failed',
  'fired',
  'started',
  'suspended',
]);

export const WorkItemSchema = z.object({
  workItemId: z.string(),
  caseId: z.string(),
  taskId: z.string(),
  status: WorkItemStatusSchema,
  createdAt: z.string().datetime(),
  startedAt: z.string().datetime().optional(),
  completedAt: z.string().datetime().optional(),
  ownerId: z.string().optional(),
  startedById: z.string().optional(),
  completedById: z.string().optional(),
  workItemData: z.record(z.unknown()).default({}),
  timerExpiry: z.string().datetime().optional(),
});

export const VALID_WORKITEM_TRANSITIONS = {
  'enabled': ['fired', 'allocated', 'cancelled'],
  'fired': ['started', 'cancelled'],
  'allocated': ['started', 'cancelled'],
  'started': ['completed', 'suspended', 'failed', 'cancelled'],
  'suspended': ['started', 'cancelled'],
  'completed': [],
  'failed': [],
  'cancelled': [],
};

/**
 * Check if a work item status transition is valid
 * @param {string} from
 * @param {string} to
 * @returns {boolean}
 */
export function isValidWorkItemTransition(from, to) {
  return VALID_WORKITEM_TRANSITIONS[from]?.includes(to) ?? false;
}

/**
 * Check if work item is in a terminal state
 * @param {string} status
 * @returns {boolean}
 */
export function isTerminalStatus(status) {
  return ['completed', 'failed', 'cancelled'].includes(status);
}

/**
 * Check if work item is active (can be worked on)
 * @param {string} status
 * @returns {boolean}
 */
export function isActiveStatus(status) {
  return ['enabled', 'fired', 'allocated', 'started'].includes(status);
}
