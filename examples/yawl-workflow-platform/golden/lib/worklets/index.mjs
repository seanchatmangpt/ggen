/**
 * @fileoverview YAWL Worklet Index
 * Generated from RDF worklet specifications
 * DO NOT EDIT - auto-generated by ggen sync
 * @module worklets
 */

import { z } from 'zod';

// =============================================================================
// Worklet Definitions
// =============================================================================

export const WORKLETS = [
  {
    workletId: 'dynamic-subprocess-selector',
    workletName: 'DynamicSubprocessSelector',
    workletType: 'SelectionWorklet',
    exceptionType: null,
  },
  {
    workletId: 'external-failure-handler',
    workletName: 'ExternalFailureHandler',
    workletType: 'ExceptionHandler',
    exceptionType: 'External Failure',
  },
  {
    workletId: 'resource-handler',
    workletName: 'ResourceUnavailableHandler',
    workletType: 'ExceptionHandler',
    exceptionType: 'Resource Unavailable',
  },
  {
    workletId: 'timeout-handler',
    workletName: 'TimeoutExceptionHandler',
    workletType: 'ExceptionHandler',
    exceptionType: 'Timeout',
  },
  {
    workletId: 'validation-handler',
    workletName: 'ValidationErrorHandler',
    workletType: 'ExceptionHandler',
    exceptionType: 'Validation Error',
  },
];

// =============================================================================
// Worklet by Exception Type
// =============================================================================

export const WORKLETS_BY_EXCEPTION = {
  'Timeout': WORKLETS.find(w => w.exceptionType === 'Timeout'),
  'Resource Unavailable': WORKLETS.find(w => w.exceptionType === 'Resource Unavailable'),
  'Validation Error': WORKLETS.find(w => w.exceptionType === 'Validation Error'),
  'External Failure': WORKLETS.find(w => w.exceptionType === 'External Failure'),
};

// =============================================================================
// Worklet Registry
// =============================================================================

export class WorkletRegistry {
  /** @type {Map<string, object>} */
  #worklets = new Map();

  /** @type {Map<string, object>} */
  #exceptionHandlers = new Map();

  constructor() {
    for (const worklet of WORKLETS) {
      this.#worklets.set(worklet.workletId, worklet);
      if (worklet.exceptionType) {
        this.#exceptionHandlers.set(worklet.exceptionType, worklet);
      }
    }
  }

  /**
   * Get worklet by ID
   * @param {string} workletId
   * @returns {object|undefined}
   */
  getWorklet(workletId) {
    return this.#worklets.get(workletId);
  }

  /**
   * Get exception handler for a given exception type
   * @param {string} exceptionType
   * @returns {object|undefined}
   */
  getExceptionHandler(exceptionType) {
    return this.#exceptionHandlers.get(exceptionType);
  }

  /**
   * Get all worklets
   * @returns {Array}
   */
  getAllWorklets() {
    return Array.from(this.#worklets.values());
  }

  /**
   * Get all exception handlers
   * @returns {Array}
   */
  getAllExceptionHandlers() {
    return Array.from(this.#exceptionHandlers.values());
  }

  /**
   * Get selection worklets (non-exception handlers)
   * @returns {Array}
   */
  getSelectionWorklets() {
    return WORKLETS.filter(w => w.workletType === 'SelectionWorklet');
  }
}

// =============================================================================
// Singleton Instance
// =============================================================================

export const workletRegistry = new WorkletRegistry();

// =============================================================================
// Helper Functions
// =============================================================================

/**
 * Check if a worklet exists for an exception type
 * @param {string} exceptionType
 * @returns {boolean}
 */
export function hasExceptionHandler(exceptionType) {
  return !!WORKLETS_BY_EXCEPTION[exceptionType];
}

/**
 * Get supported exception types
 * @returns {string[]}
 */
export function getSupportedExceptionTypes() {
  return Object.keys(WORKLETS_BY_EXCEPTION).filter(k => WORKLETS_BY_EXCEPTION[k]);
}
