<?xml version="1.0" encoding="UTF-8"?>
<specificationSet xmlns="http://www.yawlfoundation.org/yawlschema"
                  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  version="4.0"
                  xsi:schemaLocation="http://www.yawlfoundation.org/yawlschema YAWL_Schema4.0.xsd">

  <!-- Workflow: Order Processing Workflow -->
  <specification uri="order-processing">
    <documentation>Order processing with parallel payment and inventory checks</documentation>
    <metaData>
      <title>Order Processing Workflow</title>
      <version>1.0.0</version>
      <persistent>false</persistent>
      <identifier>order-processing</identifier>
    </metaData>

    <xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
      <xs:complexType name="CaseDataType">
        <xs:sequence>
          <xs:element name="caseId" type="xs:string"/>
          <xs:element name="startTime" type="xs:dateTime"/>
          <xs:element name="status" type="xs:string"/>
          <xs:element name="customData" type="xs:anyType" minOccurs="0"/>
        </xs:sequence>
      </xs:complexType>
    </xs:schema>

    <decomposition id="order-processing_Net" isRootNet="true" xsi:type="NetFactsType">
      <name>Order Processing Workflow</name>

      <localVariable>
        <index>0</index>
        <name>caseData</name>
        <type>CaseDataType</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
        <initialValue>{"caseId": "", "startTime": "", "status": "active"}</initialValue>
      </localVariable>

      <processControlElements>

        <inputCondition id="InputCondition_order-processing">
          <name>Order Received</name>
          <documentation>Start of Order Processing Workflow</documentation>
        </inputCondition>

        <!-- Task: receive-order (AND-split) -->
        <task id="receive-order">
          <name>Receive Order</name>
          <flowsInto>
            <nextElementRef id="verify-payment"/>
          </flowsInto>
          <flowsInto>
            <nextElementRef id="check-inventory"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <decomposesTo id="receive-order_Decomposition"/>
        </task>

        <!-- Task: verify-payment -->
        <task id="verify-payment">
          <name>Verify Payment</name>
          <flowsInto>
            <nextElementRef id="fulfill-order"/>
          </flowsInto>
          <join code="xor"/>
          <split code="xor"/>
          <decomposesTo id="verify-payment_Decomposition"/>
        </task>

        <!-- Task: check-inventory -->
        <task id="check-inventory">
          <name>Check Inventory</name>
          <flowsInto>
            <nextElementRef id="fulfill-order"/>
          </flowsInto>
          <join code="xor"/>
          <split code="xor"/>
          <decomposesTo id="check-inventory_Decomposition"/>
        </task>

        <!-- Task: fulfill-order (AND-join) -->
        <task id="fulfill-order">
          <name>Fulfill Order</name>
          <flowsInto>
            <nextElementRef id="ship-order"/>
          </flowsInto>
          <join code="and"/>
          <split code="xor"/>
          <decomposesTo id="fulfill-order_Decomposition"/>
        </task>

        <!-- Task: ship-order -->
        <task id="ship-order">
          <name>Ship Order</name>
          <flowsInto>
            <nextElementRef id="OutputCondition_order-processing"/>
          </flowsInto>
          <join code="xor"/>
          <split code="xor"/>
          <decomposesTo id="ship-order_Decomposition"/>
        </task>

        <outputCondition id="OutputCondition_order-processing">
          <name>Order Shipped</name>
          <documentation>End of Order Processing Workflow</documentation>
        </outputCondition>

      </processControlElements>
    </decomposition>

    <decomposition id="receive-order_Decomposition" xsi:type="WebServiceGatewayFactsType">
      <name>Receive Order Service</name>
      <externalInteraction>automated</externalInteraction>
    </decomposition>

    <decomposition id="verify-payment_Decomposition" xsi:type="WebServiceGatewayFactsType">
      <name>Verify Payment Service</name>
      <externalInteraction>automated</externalInteraction>
    </decomposition>

    <decomposition id="check-inventory_Decomposition" xsi:type="WebServiceGatewayFactsType">
      <name>Check Inventory Service</name>
      <externalInteraction>automated</externalInteraction>
    </decomposition>

    <decomposition id="fulfill-order_Decomposition" xsi:type="WebServiceGatewayFactsType">
      <name>Fulfill Order Service</name>
      <externalInteraction>manual</externalInteraction>
    </decomposition>

    <decomposition id="ship-order_Decomposition" xsi:type="WebServiceGatewayFactsType">
      <name>Ship Order Service</name>
      <externalInteraction>automated</externalInteraction>
    </decomposition>

  </specification>

</specificationSet>
