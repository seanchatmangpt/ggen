---
to: "lib/definitions/flows.ts"
description: TypeScript flow definitions with conditions
vars:
  specId: string
  sourceTaskId: string
  targetTaskId: string
metadata:
  category: definitions
  framework: typescript
---
{# =============================================================================
   FLOW DEFINITIONS TEMPLATE
   DO NOT EDIT - auto-generated by ggen sync
   ============================================================================= #}
/**
 * @fileoverview YAWL Flow Definitions
 * Generated from RDF ontology specifications
 * DO NOT EDIT - auto-generated by ggen sync
 */

import { z } from 'zod';

export const FlowDefinitionSchema = z.object({
  flowId: z.string().optional(),
  sourceTaskId: z.string(),
  targetTaskId: z.string(),
  condition: z.string().optional(),
  priority: z.number().int().default(1),
  isDefault: z.boolean().default(false),
});

export type FlowDefinition = z.infer<typeof FlowDefinitionSchema>;

{%- set current_spec = "" %}
{%- for row in sparql_results %}
{%- set specId = row["?specId"] | default(value="") %}
{%- set sourceTaskId = row["?sourceTaskId"] | default(value="") %}
{%- set targetTaskId = row["?targetTaskId"] | default(value="") %}
{%- set flowCondition = row["?flowCondition"] | default(value="") %}
{%- set flowPriority = row["?flowPriority"] | default(value="1") %}
{%- set isDefaultFlow = row["?isDefaultFlow"] | default(value="false") %}

{%- if specId != current_spec and specId != "" %}
{%- if current_spec != "" %}
];

{%- endif %}
{%- set_global current_spec = specId %}
export const {{ specId | replace(from="-", to="_") | upper }}_FLOWS: FlowDefinition[] = [
{%- endif %}

{%- if sourceTaskId != "" %}
  {
    flowId: '{{ sourceTaskId }}-{{ targetTaskId }}',
    sourceTaskId: '{{ sourceTaskId }}',
    targetTaskId: '{{ targetTaskId }}',
{%- if flowCondition != "" %}
    condition: '{{ flowCondition | replace(from="'", to="\\'") }}',
{%- endif %}
    priority: {{ flowPriority }},
    isDefault: {{ isDefaultFlow }},
  },
{%- endif %}
{%- endfor %}
];

export class FlowRegistry {
  private flows: Map<string, FlowDefinition[]> = new Map();

  constructor() {
{%- set seen_specs = "" %}
{%- for row in sparql_results %}
{%- set specId = row["?specId"] | default(value="") %}
{%- if specId != "" and specId not in seen_specs %}
{%- set_global seen_specs = seen_specs ~ "," ~ specId %}
    this.flows.set('{{ specId }}', {{ specId | replace(from="-", to="_") | upper }}_FLOWS);
{%- endif %}
{%- endfor %}
  }

  getFlows(specId: string): FlowDefinition[] {
    return this.flows.get(specId) || [];
  }

  getOutgoingFlows(specId: string, taskId: string): FlowDefinition[] {
    return this.getFlows(specId).filter(f => f.sourceTaskId === taskId);
  }

  getIncomingFlows(specId: string, taskId: string): FlowDefinition[] {
    return this.getFlows(specId).filter(f => f.targetTaskId === taskId);
  }
}

export const flowRegistry = new FlowRegistry();
