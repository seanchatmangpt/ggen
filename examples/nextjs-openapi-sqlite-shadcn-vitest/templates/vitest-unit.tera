---
to: lib/tests/unit.test.ts
description: Vitest unit tests with snapshots for Zod schemas
vars:
  entityName: string
  propName: string
metadata:
  category: testing
  framework: vitest
  features: [snapshots, schema-validation]
---
{# =============================================================================
   UNIT TESTS WITH SNAPSHOTS - Generated from RDF ontology
   DO NOT EDIT - auto-generated by ggen sync
   ============================================================================= #}
/**
 * @fileoverview Vitest unit tests with snapshot testing for Zod schemas
 * DO NOT EDIT - auto-generated by ggen sync
 */

import { describe, it, expect } from "vitest";
import * as schemas from "@/schemas";

// =============================================================================
// Test Fixtures
// =============================================================================

const fixtures = {
{%- set seen_entities = "" -%}
{%- for row in sparql_results -%}
{%- set entityName = row["?entityName"] | default(value="") -%}
{%- if entityName != "" and entityName not in seen_entities -%}
{%- set_global seen_entities = seen_entities ~ "," ~ entityName %}
  {{ entityName | lower }}: {
    valid: {
      id: "{{ entityName | lower }}-123",
      createdAt: "2024-01-01T00:00:00.000Z",
{%- for inner in sparql_results -%}
{%- if inner["?entityName"] == entityName -%}
{%- set propName = inner["?propName"] | default(value="") -%}
{%- set propType = inner["?propType"] | default(value="string") -%}
{%- if propName != "id" and propName != "createdAt" %}
      {{ propName }}: {% if propType == "string" %}"test-{{ propName }}"{% elif propType == "integer" %}42{% elif propType == "boolean" %}true{% elif propType == "datetime" %}"2024-01-01T00:00:00.000Z"{% elif propType == "enum" %}"todo"{% else %}"test"{% endif %},
{%- endif -%}
{%- endif -%}
{%- endfor %}
    },
    invalid: {
      id: null,
      createdAt: "invalid-date",
    },
  },
{%- endif -%}
{%- endfor %}
};

// =============================================================================
// Schema Tests with Snapshots
// =============================================================================

{%- set current_entity = "" -%}
{%- for row in sparql_results -%}
{%- set entityName = row["?entityName"] | default(value="") -%}
{%- set propName = row["?propName"] | default(value="") -%}
{%- set propType = row["?propType"] | default(value="string") -%}
{%- set required = row["?required"] | default(value="false") -%}
{%- set format = row["?format"] | default(value="") -%}

{%- if entityName != current_entity and entityName != "" -%}
{%- if current_entity != "" %}
  });

  describe("snapshot tests", () => {
    it("should match valid data snapshot", () => {
      const result = schemas.{{ current_entity | lower }}Schema.safeParse(fixtures.{{ current_entity | lower }}.valid);
      expect(result).toMatchSnapshot();
    });

    it("should match schema shape snapshot", () => {
      expect(schemas.{{ current_entity | lower }}Schema.shape).toMatchSnapshot();
    });

    it("should match error snapshot for invalid data", () => {
      const result = schemas.{{ current_entity | lower }}Schema.safeParse(fixtures.{{ current_entity | lower }}.invalid);
      if (!result.success) {
        expect(result.error.format()).toMatchSnapshot();
      }
    });
  });
});

{% endif -%}
{%- set_global current_entity = entityName %}
describe("{{ entityName }} Schema", () => {
  describe("validation", () => {
    it("should validate valid {{ entityName | lower }} data", () => {
      // Arrange
      const validData = fixtures.{{ entityName | lower }}.valid;

      // Act
      const result = schemas.{{ entityName | lower }}Schema.safeParse(validData);

      // Assert
      expect(result.success).toBe(true);
      if (result.success) {
        expect(result.data).toEqual(validData);
      }
    });

    it("should reject invalid {{ entityName | lower }} data", () => {
      // Arrange
      const invalidData = fixtures.{{ entityName | lower }}.invalid;

      // Act
      const result = schemas.{{ entityName | lower }}Schema.safeParse(invalidData);

      // Assert
      expect(result.success).toBe(false);
    });

    it("should reject empty object", () => {
      const result = schemas.{{ entityName | lower }}Schema.safeParse({});
      expect(result.success).toBe(false);
    });
{%- endif -%}
{%- endfor %}
  });

  describe("snapshot tests", () => {
    it("should match valid data snapshot", () => {
      const result = schemas.{{ current_entity | lower }}Schema.safeParse(fixtures.{{ current_entity | lower }}.valid);
      expect(result).toMatchSnapshot();
    });

    it("should match schema shape snapshot", () => {
      expect(schemas.{{ current_entity | lower }}Schema.shape).toMatchSnapshot();
    });

    it("should match error snapshot for invalid data", () => {
      const result = schemas.{{ current_entity | lower }}Schema.safeParse(fixtures.{{ current_entity | lower }}.invalid);
      if (!result.success) {
        expect(result.error.format()).toMatchSnapshot();
      }
    });
  });

  describe("create schema", () => {
    it("should omit id and createdAt", () => {
      const { id, createdAt, ...createData } = fixtures.{{ current_entity | lower }}.valid;
      const result = schemas.create{{ current_entity }}Schema.safeParse(createData);
      expect(result.success).toBe(true);
    });

    it("should match create schema snapshot", () => {
      expect(schemas.create{{ current_entity }}Schema.shape).toMatchSnapshot();
    });
  });

  describe("update schema", () => {
    it("should allow partial updates", () => {
      const partialData = { name: "Updated" };
      const result = schemas.update{{ current_entity }}Schema.safeParse(partialData);
      expect(result.success).toBe(true);
    });

    it("should match update schema snapshot", () => {
      expect(schemas.update{{ current_entity }}Schema.shape).toMatchSnapshot();
    });
  });
});
