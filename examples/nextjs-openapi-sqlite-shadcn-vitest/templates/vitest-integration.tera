---
to: lib/tests/integration.test.ts
description: Vitest integration tests for API
metadata:
  category: testing
  framework: vitest
---
/**
 * @fileoverview Vitest integration tests for API routes
 * DO NOT EDIT - auto-generated by ggen sync
 */

import { describe, it, expect, vi, beforeEach } from "vitest";
import { NextRequest } from "next/server";

// Mock database
vi.mock("@/db", () => ({
  db: {
    select: vi.fn().mockReturnThis(),
    from: vi.fn().mockReturnThis(),
    where: vi.fn().mockReturnThis(),
    limit: vi.fn().mockResolvedValue([]),
    insert: vi.fn().mockReturnThis(),
    values: vi.fn().mockReturnThis(),
    returning: vi.fn().mockResolvedValue([{ id: "test-id" }]),
    update: vi.fn().mockReturnThis(),
    set: vi.fn().mockReturnThis(),
    delete: vi.fn().mockReturnThis(),
  },
}));

{%- set current_entity = "" -%}
{%- for row in sparql_results -%}
{%- set entityName = row["?entityName"] | default(value="") -%}
{%- set path = row["?path"] | default(value="") -%}
{%- set method = row["?method"] | default(value="GET") -%}
{%- set operationId = row["?operationId"] | default(value="") -%}

{%- if entityName != current_entity -%}
{%- if current_entity != "" %}
});

{% endif -%}
{%- set_global current_entity = entityName %}
describe("{{ entityName }} API", () => {
  beforeEach(() => {
    vi.clearAllMocks();
  });
{%- endif %}

  describe("{{ method }} {{ path }}", () => {
    it("should {{ operationId }}", async () => {
      // Arrange
      const request = new NextRequest("http://localhost:3000{{ path | replace(from="[id]", to="test-id") }}", {
        method: "{{ method }}",
{%- if method == "POST" or method == "PUT" %}
        body: JSON.stringify({ name: "Test" }),
{%- endif %}
      });

      // Act & Assert
      // API handler tests would go here
      expect(true).toBe(true);
    });

    it("should handle errors", async () => {
      // Arrange
      const request = new NextRequest("http://localhost:3000{{ path | replace(from="[id]", to="invalid") }}");

      // Act & Assert
      expect(true).toBe(true);
    });
  });
{%- endfor %}
});
