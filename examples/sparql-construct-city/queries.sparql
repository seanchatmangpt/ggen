## SPARQL CONSTRUCT Queries for City Data
## 8 Bleeding Edge Best Practices

# Query 1: OPTIONAL Properties
PREFIX city: <http://example.org/city/>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

CONSTRUCT {
  ?city a city:CityProfile ;
    city:name ?name ;
    city:population ?pop ;
    city:currentMayor ?mayorName ;
    city:hasMayorInfo ?hasMayorInfo .
}
WHERE {
  ?city a city:City ;
    rdfs:label ?name ;
    city:population ?pop .

  OPTIONAL {
    ?mayor city:mayorsOf ?city ;
      foaf:name ?mayorName ;
      FILTER NOT EXISTS { ?mayor city:endYear ?end }
  }

  BIND(BOUND(?mayorName) AS ?hasMayorInfo)
}

---

# Query 2: BIND for Computed Values
PREFIX city: <http://example.org/city/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

CONSTRUCT {
  ?city a city:CityAnalysis ;
    city:name ?name ;
    city:populationDensity ?density ;
    city:sizeCategory ?sizeCategory ;
    city:foundingEra ?era .
}
WHERE {
  ?city a city:City ;
    rdfs:label ?name ;
    city:population ?pop ;
    city:area ?area ;
    city:founded ?founded .

  BIND(?pop / ?area AS ?density)
  BIND(
    IF(?pop > 1000000, "Major",
      IF(?pop > 100000, "Large",
        IF(?pop > 50000, "Medium", "Small")))
    AS ?sizeCategory
  )
  BIND(
    IF(?founded < 1700, "Colonial",
      IF(?founded < 1850, "Industrial",
        IF(?founded < 1950, "Modern", "Contemporary")))
    AS ?era
  )
}

---

# Query 3: FILTER Expressions
PREFIX city: <http://example.org/city/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

CONSTRUCT {
  ?city a city:SignificantCity ;
    city:name ?name ;
    city:population ?pop ;
    city:landmarkCount ?landmarkCount .
}
WHERE {
  ?city a city:City ;
    rdfs:label ?name ;
    city:population ?pop ;
    city:isMajor true .

  FILTER (?pop > 500000)

  {
    SELECT ?city (COUNT(?landmark) AS ?landmarkCount)
    WHERE {
      ?landmark city:locatedIn ?city .
    }
    GROUP BY ?city
  }
}

---

# Query 4: UNION for Alternative Patterns
PREFIX city: <http://example.org/city/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

CONSTRUCT {
  ?poi a city:PointOfInterest ;
    city:name ?name ;
    city:locatedIn ?city ;
    city:poiType ?poiType .
}
WHERE {
  {
    ?poi a city:Landmark ;
      rdfs:label ?name ;
      city:locatedIn ?city ;
      city:type ?poiType .
  }
  UNION
  {
    ?poi a city:Event ;
      rdfs:label ?name ;
      city:heldIn ?city .
    BIND("Event" AS ?poiType)
  }
}

---

# Query 5: GROUP_CONCAT Aggregation
PREFIX city: <http://example.org/city/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

CONSTRUCT {
  ?city a city:CityProfile ;
    city:name ?name ;
    city:neighborsList ?neighborsList ;
    city:landmarksList ?landmarksList .
}
WHERE {
  ?city a city:City ;
    rdfs:label ?name .

  {
    SELECT ?city (GROUP_CONCAT(DISTINCT ?neighborName; separator=" | ") AS ?neighborsList)
    WHERE {
      ?city city:hasNeighbor ?neighbor .
      ?neighbor rdfs:label ?neighborName .
    }
    GROUP BY ?city
  }

  {
    SELECT ?city (GROUP_CONCAT(DISTINCT ?landmarkName; separator=" | ") AS ?landmarksList)
    WHERE {
      ?landmark city:locatedIn ?city .
      ?landmark rdfs:label ?landmarkName .
    }
    GROUP BY ?city
  }
}

---

# Query 6: VALUES for Dynamic Parameters
PREFIX city: <http://example.org/city/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

CONSTRUCT {
  ?city a city:BayAreaCity ;
    city:name ?name ;
    city:population ?pop ;
    city:region "Bay Area" ;
    city:neighborCount ?neighborCount .
}
WHERE {
  VALUES ?city {
    city:sf
    city:oakland
    city:berkeley
  }

  ?city a city:City ;
    rdfs:label ?name ;
    city:population ?pop .

  {
    SELECT ?city (COUNT(?neighbor) AS ?neighborCount)
    WHERE {
      ?city city:hasNeighbor ?neighbor .
    }
    GROUP BY ?city
  }
}

---

# Query 7: FILTER EXISTS / NOT EXISTS
PREFIX city: <http://example.org/city/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

CONSTRUCT {
  ?city a city:CityCharacteristic ;
    city:name ?name ;
    city:hasLandmarks ?hasLandmarks ;
    city:hasMayors ?hasMayors ;
    city:characterType ?characterType .
}
WHERE {
  ?city a city:City ;
    rdfs:label ?name .

  BIND(
    IF(EXISTS {?landmark city:locatedIn ?city}, true, false)
    AS ?hasLandmarks
  )

  BIND(
    IF(EXISTS {?mayor city:mayorsOf ?city}, true, false)
    AS ?hasMayors
  )

  BIND(
    IF(?hasLandmarks && ?hasMayors, "Historic",
      IF(?hasLandmarks, "Unmapped",
        IF(?hasMayors, "Unlandmarked", "Unknown")))
    AS ?characterType
  )
}

---

# Query 8: Property Paths
PREFIX city: <http://example.org/city/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

CONSTRUCT {
  ?startCity a city:CityWithTransitiveLandmarks ;
    city:name ?startName ;
    city:reachableLandmark ?landmarkName ;
    city:landmarkType ?landmarkType .
}
WHERE {
  ?startCity a city:City ;
    rdfs:label ?startName ;
    city:hasNeighbor+ ?reachableCity .

  ?landmark city:locatedIn ?reachableCity ;
    rdfs:label ?landmarkName ;
    city:type ?landmarkType .
}
