---
to: output/user-stories.mjs
description: User stories from high-opportunity job steps
metadata:
  category: jtbd
  output_type: requirements
---
/**
 * @fileoverview JTBD User Stories
 * Generated from job steps with opportunity score >= 12
 * DO NOT EDIT - auto-generated by ggen sync
 * @module jtbd/user-stories
 */

/**
 * @typedef {Object} UserStory
 * @property {string} id
 * @property {string} avatar
 * @property {string} asA
 * @property {string} iWant
 * @property {string} soThat
 * @property {string} currentWorkaround
 * @property {string} painPoint
 * @property {number} opportunityScore
 * @property {string[]} acceptanceCriteria
 */

/**
 * High-opportunity user stories
 * @type {UserStory[]}
 */
export const userStories = [
{%- set story_id = 0 -%}
{%- for row in sparql_results %}
{%- set story_id = story_id + 1 %}
  {
    id: "US-{{ story_id | slugify }}",
    avatar: "{{ row["?avatarName"] }}",
    asA: "{{ row["?avatarName"] }}",
    iWant: "{{ row["?stepDescription"] | lower }}",
    soThat: "I can avoid: {{ row["?painPoint"] | lower }}",
    currentWorkaround: "{{ row["?currentSolution"] }}",
    painPoint: "{{ row["?painPoint"] }}",
    opportunityScore: {{ row["?opportunityScore"] }},
    acceptanceCriteria: [
      "Given I am a {{ row["?avatarName"] }}",
      "When I need to {{ row["?stepDescription"] | lower }}",
      "Then the solution is faster/easier than {{ row["?currentSolution"] | lower }}",
      "And I no longer experience: {{ row["?painPoint"] | lower }}",
    ],
  },
{%- endfor %}
];

/**
 * Format user story as string
 * @param {UserStory} story
 * @returns {string}
 */
export function formatStory(story) {
  return `As a ${story.asA}, I want to ${story.iWant}, so that ${story.soThat}`;
}

/**
 * Get stories by avatar
 * @param {string} avatarName
 * @returns {UserStory[]}
 */
export function getStoriesByAvatar(avatarName) {
  return userStories.filter(s => s.avatar === avatarName);
}

/**
 * Export stories to markdown
 * @returns {string}
 */
export function toMarkdown() {
  return userStories.map(s => `
## ${s.id}: ${s.iWant}

**As a** ${s.asA}
**I want to** ${s.iWant}
**So that** ${s.soThat}

### Current Workaround
${s.currentWorkaround}

### Pain Point
${s.painPoint}

### Acceptance Criteria
${s.acceptanceCriteria.map(ac => `- ${ac}`).join('\n')}

---
`).join('\n');
}

// Summary
export const stats = {
  totalStories: userStories.length,
  byAvatar: userStories.reduce((acc, s) => {
    acc[s.avatar] = (acc[s.avatar] || 0) + 1;
    return acc;
  }, {}),
};
