---
to: output/opportunities.mjs
description: Prioritized opportunity matrix
metadata:
  category: jtbd
  output_type: analysis
---
/**
 * @fileoverview JTBD Opportunity Matrix
 * Opportunities scored using: Importance + (Importance - Satisfaction)
 * DO NOT EDIT - auto-generated by ggen sync
 * @module jtbd/opportunities
 */

/**
 * @typedef {Object} Opportunity
 * @property {string} avatar
 * @property {string} job
 * @property {string} stepType
 * @property {string} description
 * @property {string} painPoint
 * @property {number} importance
 * @property {number} satisfaction
 * @property {number} score
 * @property {"critical"|"high"|"medium"|"low"} priority
 */

/**
 * Calculate priority tier from opportunity score
 * @param {number} score
 * @returns {"critical"|"high"|"medium"|"low"}
 */
function getPriority(score) {
  if (score >= 15) return "critical";
  if (score >= 12) return "high";
  if (score >= 9) return "medium";
  return "low";
}

/**
 * All opportunities ordered by score (highest first)
 * @type {Opportunity[]}
 */
export const opportunities = [
{%- for row in sparql_results %}
  {
    avatar: "{{ row["?avatarName"] }}",
    job: "{{ row["?jobName"] }}",
    stepType: "{{ row["?stepType"] }}",
    description: "{{ row["?stepDescription"] }}",
    painPoint: "{{ row["?painPoint"] }}",
    importance: {{ row["?importance"] }},
    satisfaction: {{ row["?satisfaction"] }},
    score: {{ row["?opportunityScore"] }},
    priority: getPriority({{ row["?opportunityScore"] }}),
  },
{%- endfor %}
];

/**
 * Get opportunities by priority
 * @param {"critical"|"high"|"medium"|"low"} priority
 * @returns {Opportunity[]}
 */
export function getByPriority(priority) {
  return opportunities.filter(o => o.priority === priority);
}

/**
 * Get opportunities by avatar
 * @param {string} avatarName
 * @returns {Opportunity[]}
 */
export function getByAvatar(avatarName) {
  return opportunities.filter(o => o.avatar === avatarName);
}

/**
 * Get opportunities by job step type
 * @param {string} stepType
 * @returns {Opportunity[]}
 */
export function getByStepType(stepType) {
  return opportunities.filter(o => o.stepType === stepType);
}

/**
 * Get top N opportunities
 * @param {number} n
 * @returns {Opportunity[]}
 */
export function getTopOpportunities(n = 10) {
  return opportunities.slice(0, n);
}

// Summary statistics
export const stats = {
  total: opportunities.length,
  critical: opportunities.filter(o => o.priority === "critical").length,
  high: opportunities.filter(o => o.priority === "high").length,
  medium: opportunities.filter(o => o.priority === "medium").length,
  low: opportunities.filter(o => o.priority === "low").length,
  avgScore: opportunities.reduce((sum, o) => sum + o.score, 0) / opportunities.length,
};
