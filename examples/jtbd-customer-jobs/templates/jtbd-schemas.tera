---
to: output/schemas.mjs
description: Zod schemas for JTBD data validation
metadata:
  category: jtbd
  output_type: schemas
---
/**
 * @fileoverview JTBD Zod Validation Schemas
 * Runtime validation for JTBD data structures
 * DO NOT EDIT - auto-generated by ggen sync
 * @module jtbd/schemas
 */

import { z } from 'zod';

// =============================================================================
// Enums
// =============================================================================

export const SegmentSchema = z.enum([
  'Enterprise',
  'Mid-Market',
  'Startup',
  'Individual',
  'Community',
]);

/**
 * @typedef {z.infer<typeof SegmentSchema>} Segment
 */

export const JobStepTypeSchema = z.enum([
  '1. Define',
  '2. Locate',
  '3. Prepare',
  '4. Confirm',
  '5. Execute',
  '6. Monitor',
  '7. Modify',
  '8. Conclude',
]);

/**
 * @typedef {z.infer<typeof JobStepTypeSchema>} JobStepType
 */

export const PrioritySchema = z.enum([
  'critical',
  'high',
  'medium',
  'low',
]);

/**
 * @typedef {z.infer<typeof PrioritySchema>} Priority
 */

// =============================================================================
// Core Schemas
// =============================================================================

export const AvatarSchema = z.object({
  name: z.string().min(1),
  description: z.string(),
  segment: SegmentSchema,
  painLevel: z.number().int().min(1).max(10),
  mainJob: z.string(),
});

/**
 * @typedef {z.infer<typeof AvatarSchema>} Avatar
 */

export const JobStepSchema = z.object({
  stepType: JobStepTypeSchema,
  description: z.string(),
  currentSolution: z.string(),
  painPoint: z.string(),
  importance: z.number().int().min(1).max(10),
  satisfaction: z.number().int().min(1).max(10),
  opportunityScore: z.number(),
});

/**
 * @typedef {z.infer<typeof JobStepSchema>} JobStep
 */

export const OpportunitySchema = z.object({
  avatar: z.string(),
  job: z.string(),
  stepType: JobStepTypeSchema,
  description: z.string(),
  painPoint: z.string(),
  importance: z.number().int().min(1).max(10),
  satisfaction: z.number().int().min(1).max(10),
  score: z.number(),
  priority: PrioritySchema,
});

/**
 * @typedef {z.infer<typeof OpportunitySchema>} Opportunity
 */

export const UserStorySchema = z.object({
  id: z.string(),
  avatar: z.string(),
  asA: z.string(),
  iWant: z.string(),
  soThat: z.string(),
  currentWorkaround: z.string(),
  painPoint: z.string(),
  opportunityScore: z.number(),
  acceptanceCriteria: z.array(z.string()),
});

/**
 * @typedef {z.infer<typeof UserStorySchema>} UserStory
 */

export const FeatureSpecSchema = z.object({
  id: z.string(),
  title: z.string(),
  avatar: z.string(),
  avatarDescription: z.string(),
  job: z.string(),
  jobStep: JobStepTypeSchema,
  problem: z.string(),
  currentState: z.string(),
  importance: z.number().int().min(1).max(10),
  satisfaction: z.number().int().min(1).max(10),
  opportunityScore: z.number(),
  outcomeStatements: z.array(z.string()),
  suggestedCapabilities: z.array(z.string()),
});

/**
 * @typedef {z.infer<typeof FeatureSpecSchema>} FeatureSpec
 */

// =============================================================================
// Validation Helpers
// =============================================================================

/**
 * Validate avatar data
 * @param {unknown} data
 * @returns {Avatar}
 */
export function validateAvatar(data) {
  return AvatarSchema.parse(data);
}

/**
 * Validate opportunity data
 * @param {unknown} data
 * @returns {Opportunity}
 */
export function validateOpportunity(data) {
  return OpportunitySchema.parse(data);
}

/**
 * Validate user story data
 * @param {unknown} data
 * @returns {UserStory}
 */
export function validateUserStory(data) {
  return UserStorySchema.parse(data);
}

/**
 * Calculate opportunity score from importance and satisfaction
 * @param {number} importance
 * @param {number} satisfaction
 * @returns {number}
 */
export function calculateOpportunityScore(importance, satisfaction) {
  return importance + Math.max(0, importance - satisfaction);
}

/**
 * Get priority from opportunity score
 * @param {number} score
 * @returns {Priority}
 */
export function getPriorityFromScore(score) {
  if (score >= 15) return 'critical';
  if (score >= 12) return 'high';
  if (score >= 9) return 'medium';
  return 'low';
}
