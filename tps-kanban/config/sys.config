%% System configuration for TPS Kanban production deployment

[
  {tps_kanban, [
      %% NATS configuration (primary)
      {nats_servers, ["nats://localhost:4222"]},

      %% RabbitMQ configuration (fallback/persistence)
      {rabbitmq_host, "localhost"},
      {rabbitmq_port, 5672},
      {rabbitmq_user, "guest"},
      {rabbitmq_pass, "guest"},

      %% Worker configuration
      {worker_pull_size, 10},
      {worker_process_timeout_ms, 30000},

      %% Queue configuration
      {dead_letter_timeout_ms, 300000},

      %% Coordinator configuration
      {coordinator_check_interval_ms, 5000},
      {stalled_item_threshold_ms, 300000}
  ]},

  {lager, [
      {handlers, [
          {lager_console_backend, [
              {level, info},
              {format, "[~H:~M:~S.~3N] [~s] [~p] ~s~n"}
          ]},
          {lager_file_backend, [
              {file, "log/tps_kanban.log"},
              {level, info},
              {size, 10485760},
              {date, "$D0"},
              {count, 5},
              {format, "[~H:~M:~S.~3N] [~s] [~p] ~s~n"}
          ]}
      ]}
  ]},

  {prometheus, [
      {collectors, [
          prometheus_process_collector,
          prometheus_http_handler
      ]},
      {default_metrics, [
          {gauge, kanban_queue_depth},
          {gauge, kanban_current_workers},
          {counter, kanban_published_total}
      ]}
  ]},

  {kernel, [
      {logger_level, info}
  ]}
].
