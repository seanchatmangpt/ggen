@startuml SHACL Validation Flow
!theme plain
skinparam backgroundColor #FEFEFE
skinparam handwritten false

title SHACL Validation Process Flow

participant "User" as user
participant "CLI" as cli
participant "Shape Parser" as parser
participant "Shape Compiler" as compiler
participant "Validation Engine" as engine
participant "Constraint Evaluator" as evaluator
participant "Report Generator" as reporter
database "RDF Data" as data
database "SHACL Shapes" as shapes

user -> cli: validate data.ttl --shapes shapes.ttl
activate cli

cli -> parser: Load shapes.ttl
activate parser
parser -> shapes: Read SHACL shapes
shapes --> parser: Shape definitions
parser --> cli: Parsed shapes
deactivate parser

cli -> compiler: Compile shapes
activate compiler
compiler -> compiler: Optimize constraint graph
compiler -> compiler: Build validation plan
compiler --> cli: Compiled validation engine
deactivate compiler

cli -> engine: Execute validation
activate engine

engine -> data: Load RDF data
data --> engine: RDF triples

loop For each target node
  engine -> evaluator: Evaluate constraints
  activate evaluator

  alt Node Shape Constraints
    evaluator -> evaluator: Check target class
    evaluator -> evaluator: Check target node
  else Property Shape Constraints
    evaluator -> evaluator: Check property path
    evaluator -> evaluator: Evaluate cardinality
    evaluator -> evaluator: Validate datatype
    evaluator -> evaluator: Check value constraints
  else Logical Constraints
    evaluator -> evaluator: Evaluate AND/OR/NOT/XONE
  else SPARQL Constraints
    evaluator -> evaluator: Execute SPARQL query
  end

  evaluator --> engine: Validation result
  deactivate evaluator
end

engine --> cli: Validation results
deactivate engine

cli -> reporter: Generate report
activate reporter

reporter -> reporter: Group by severity
reporter -> reporter: Format results
alt HTML Report
  reporter -> reporter: Apply template
  reporter -> reporter: Generate visualizations
else JSON Report
  reporter -> reporter: Serialize to JSON
else Turtle Report
  reporter -> reporter: Generate RDF report
else Markdown Report
  reporter -> reporter: Generate markdown
end

reporter --> cli: Formatted report
deactivate reporter

cli --> user: Display report
deactivate cli

@enduml
