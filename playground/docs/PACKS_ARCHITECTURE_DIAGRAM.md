# Packs Lifecycle Architecture - Visual Guide

## Current Architecture (Disconnected)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CURRENT STATE                                 â”‚
â”‚                        (Siloed Systems)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MARKETPLACE       â”‚         â”‚   PACKS             â”‚
â”‚   (ggen-marketplace)â”‚         â”‚   (ggen-domain)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… Install          â”‚         â”‚ âœ… List             â”‚
â”‚ âœ… Update           â”‚         â”‚ âŒ Install          â”‚
â”‚ âœ… Dependency res   â”‚         â”‚ âŒ Update           â”‚
â”‚ âœ… Lockfile mgmt    â”‚         â”‚ âŒ Regenerate       â”‚
â”‚ âœ… Cache mgmt       â”‚         â”‚ âŒ State tracking   â”‚
â”‚ âœ… Checksums        â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
         â”‚                                 â”‚
         â”‚ NO CONNECTION                   â”‚ Used once
         â”‚                                 â–¼
         â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                          â”‚ Project Generatorâ”‚
         â”‚                          â”‚ (ggen-core)      â”‚
         â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                          â”‚ âœ… Scaffolding   â”‚
         â”‚                          â”‚ âŒ Regeneration  â”‚
         â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                 â”‚
         â”‚                                 â”‚ Creates files
         â”‚                                 â–¼
         â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                          â”‚ User Project     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ~/.ggen/packages    â”‚            â”‚ src/             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚ tests/           â”‚
â”‚ Downloaded packs    â”‚â—€â”€â”€ NO â”€â”€â–¶ â”‚ Cargo.toml       â”‚
â”‚ Not used for        â”‚   LINK    â”‚ .ggen/           â”‚
â”‚ project generation  â”‚            â”‚   snapshot.json? â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â”‚ Managed by
                                          â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚ Lifecycle System â”‚
                                   â”‚ (ggen-core)      â”‚
                                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                   â”‚ âœ… Phase exec    â”‚
                                   â”‚ âœ… State track   â”‚
                                   â”‚ âŒ Regeneration  â”‚
                                   â”‚ âŒ Pack updates  â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Target Architecture (Integrated Lifecycle)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TARGET STATE                                          â”‚
â”‚                   (Unified Pack Lifecycle)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PACK REGISTRY                                      â”‚
â”‚                    (GitHub / ggen-marketplace-v2)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“¦ rust-web@1.0.0    â”‚  ğŸ“¦ react-app@2.1.0  â”‚  ğŸ“¦ fastapi@0.5.0        â”‚
â”‚  â”œâ”€ gpack.toml        â”‚  â”œâ”€ gpack.toml        â”‚  â”œâ”€ gpack.toml           â”‚
â”‚  â”œâ”€ templates/        â”‚  â”œâ”€ templates/        â”‚  â”œâ”€ templates/           â”‚
â”‚  â”œâ”€ graphs/           â”‚  â”œâ”€ graphs/           â”‚  â”œâ”€ graphs/              â”‚
â”‚  â””â”€ queries/          â”‚  â””â”€ queries/          â”‚  â””â”€ queries/             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Download & verify
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PACK CACHE & LOCKFILE                                    â”‚
â”‚                      (~/.ggen/packages)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ~/.ggen/packages/                  ggen.lock (Project)                    â”‚
â”‚    â”œâ”€ rust-web@1.0.0/          {                                           â”‚
â”‚    â”œâ”€ rust-web@1.1.0/            "packs": [                                â”‚
â”‚    â””â”€ react-app@2.1.0/             {                                       â”‚
â”‚                                      "id": "rust-web",                     â”‚
â”‚  [Cached, versioned]                 "version": "1.1.0",                   â”‚
â”‚                                      "files": [                            â”‚
â”‚                                        "src/main.rs" â†’ "rust-web@1.1.0",  â”‚
â”‚                                        "Cargo.toml"  â†’ "rust-web@1.1.0"   â”‚
â”‚                                      ]                                     â”‚
â”‚                                    }                                       â”‚
â”‚                                  ]                                         â”‚
â”‚                                }                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                     â”‚
                         â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   INITIAL GENERATION        â”‚    â”‚   REGENERATION              â”‚
â”‚   (ggen new my-app)         â”‚    â”‚   (ggen packs update)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Select pack(s)           â”‚    â”‚ 1. Detect pack update       â”‚
â”‚ 2. Download from cache      â”‚    â”‚ 2. Load baseline snapshot   â”‚
â”‚ 3. Render templates         â”‚    â”‚ 3. Detect manual edits      â”‚
â”‚ 4. Create files             â”‚    â”‚ 4. Regenerate with new pack â”‚
â”‚ 5. Create baseline snapshot â”‚    â”‚ 5. Three-way merge          â”‚
â”‚ 6. Update ggen.lock         â”‚    â”‚ 6. Update snapshot          â”‚
â”‚ 7. Run lifecycle init       â”‚    â”‚ 7. Update ggen.lock         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                                 â”‚
                 â”‚ Creates                         â”‚ Updates
                 â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER PROJECT                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  my-app/                                                             â”‚
â”‚    â”œâ”€ src/                                                           â”‚
â”‚    â”‚   â”œâ”€ main.rs          â—€â”€â”€â”€â”€â”€ Generated (pack=rust-web@1.1.0)   â”‚
â”‚    â”‚   â”œâ”€ models/          â—€â”€â”€â”€â”€â”€ Generated                         â”‚
â”‚    â”‚   â””â”€ custom.rs        â—€â”€â”€â”€â”€â”€ Manual edit (preserved)           â”‚
â”‚    â”œâ”€ tests/               â—€â”€â”€â”€â”€â”€ Generated + manual                â”‚
â”‚    â”œâ”€ Cargo.toml           â—€â”€â”€â”€â”€â”€ Generated (merged)                â”‚
â”‚    â”œâ”€ .ggen/                                                         â”‚
â”‚    â”‚   â”œâ”€ snapshot.json    â—€â”€â”€â”€â”€â”€ Baseline for three-way merge      â”‚
â”‚    â”‚   â”‚   {                                                         â”‚
â”‚    â”‚   â”‚     "packs": [{                                             â”‚
â”‚    â”‚   â”‚       "pack_id": "rust-web",                                â”‚
â”‚    â”‚   â”‚       "version": "1.1.0",                                   â”‚
â”‚    â”‚   â”‚       "files": ["src/main.rs", "Cargo.toml"]                â”‚
â”‚    â”‚   â”‚     }],                                                     â”‚
â”‚    â”‚   â”‚     "files": [{                                             â”‚
â”‚    â”‚   â”‚       "path": "src/main.rs",                                â”‚
â”‚    â”‚   â”‚       "hash": "abc123",                                     â”‚
â”‚    â”‚   â”‚       "regions": [                                          â”‚
â”‚    â”‚   â”‚         {"type": "generated", "start": 1, "end": 10},       â”‚
â”‚    â”‚   â”‚         {"type": "manual", "start": 11, "end": 20}          â”‚
â”‚    â”‚   â”‚       ]                                                     â”‚
â”‚    â”‚   â”‚     }]                                                      â”‚
â”‚    â”‚   â”‚   }                                                         â”‚
â”‚    â”‚   â”œâ”€ state.json       â—€â”€â”€â”€â”€â”€ Lifecycle state                   â”‚
â”‚    â”‚   â””â”€ make.toml        â—€â”€â”€â”€â”€â”€ Lifecycle config                  â”‚
â”‚    â””â”€ ggen.lock            â—€â”€â”€â”€â”€â”€ Pack versions + file mappings     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Triggers
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      LIFECYCLE SYSTEM                                 â”‚
â”‚                    (make.toml phases)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Phases:                                                             â”‚
â”‚    init      â†’ Initialize project (post-generation)                  â”‚
â”‚    template  â†’ Regenerate from packs (NEW)                           â”‚
â”‚    build     â†’ Compile project                                       â”‚
â”‚    test      â†’ Run tests                                             â”‚
â”‚    deploy    â†’ Deploy to production                                  â”‚
â”‚                                                                       â”‚
â”‚  Hooks:                                                              â”‚
â”‚    before_template â†’ Check for conflicts                             â”‚
â”‚    after_template  â†’ Run tests, format code                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: Pack Update Scenario

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SCENARIO: Updating rust-web from 1.0.0 â†’ 1.1.0               â”‚
â”‚           (User has made manual edits to src/custom.rs)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Check for Updates
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$ ggen packs update rust-web

  Registry Check: rust-web@1.1.0 available (current: 1.0.0)
  Changelog:
    - Add tracing support to main.rs
    - Update Cargo.toml with new dependencies
    - Add health check endpoint

Step 2: Load Baseline Snapshot
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Read: .ggen/snapshot.json
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Baseline (rust-web@1.0.0)              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ src/main.rs:                           â”‚
  â”‚   hash: "abc123"                        â”‚
  â”‚   regions:                              â”‚
  â”‚     [generated: lines 1-50]             â”‚
  â”‚                                         â”‚
  â”‚ src/custom.rs: (not in snapshot)       â”‚
  â”‚                                         â”‚
  â”‚ Cargo.toml:                             â”‚
  â”‚   hash: "def456"                        â”‚
  â”‚   regions:                              â”‚
  â”‚     [generated: lines 1-20]             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 3: Detect Manual Edits
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Diff: Current files vs Baseline snapshot

  src/main.rs:
    âœ“ Unchanged (hash matches)

  src/custom.rs:
    âš  NEW FILE (manual addition)

  Cargo.toml:
    âœ“ Unchanged (hash matches)

Step 4: Download New Pack & Regenerate
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Download: rust-web@1.1.0 from cache
  Render templates with same variables

  Generated (rust-web@1.1.0):
    src/main.rs â†’ NEW version
    Cargo.toml  â†’ NEW version

Step 5: Three-Way Merge
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  For each file:

  â”Œâ”€ src/main.rs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Baseline (1.0.0):  "abc123"            â”‚
  â”‚ Current:           "abc123" (unchanged)â”‚
  â”‚ New (1.1.0):       "xyz789" (changed)  â”‚
  â”‚                                         â”‚
  â”‚ Decision: SAFE UPDATE                  â”‚
  â”‚   â†’ Apply new version (no conflict)    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€ src/custom.rs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Baseline:          (not present)       â”‚
  â”‚ Current:           EXISTS (manual)     â”‚
  â”‚ New:               (not generated)     â”‚
  â”‚                                         â”‚
  â”‚ Decision: PRESERVE                     â”‚
  â”‚   â†’ Keep user's file untouched         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€ Cargo.toml â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Baseline (1.0.0):  "def456"            â”‚
  â”‚ Current:           "def456" (unchanged)â”‚
  â”‚ New (1.1.0):       "ghi012" (changed)  â”‚
  â”‚                                         â”‚
  â”‚ Decision: SAFE UPDATE                  â”‚
  â”‚   â†’ Apply new version (no conflict)    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 6: Apply Changes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Write updated files:
    âœ“ src/main.rs    (updated to 1.1.0)
    âœ“ Cargo.toml     (updated to 1.1.0)
    âœ“ src/custom.rs  (preserved)

Step 7: Update Snapshot
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Write: .ggen/snapshot.json
  {
    "packs": [{
      "pack_id": "rust-web",
      "version": "1.1.0",    â† Updated
      "files": [
        "src/main.rs",
        "Cargo.toml"
      ]
    }],
    "files": [
      {
        "path": "src/main.rs",
        "hash": "xyz789",      â† New hash
        "pack_id": "rust-web",
        "pack_version": "1.1.0"
      },
      {
        "path": "src/custom.rs",
        "hash": "manual123",
        "pack_id": null,       â† Manual file
        "pack_version": null
      },
      {
        "path": "Cargo.toml",
        "hash": "ghi012",      â† New hash
        "pack_id": "rust-web",
        "pack_version": "1.1.0"
      }
    ]
  }

Step 8: Update Lockfile
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Write: ggen.lock
  {
    "packs": [{
      "id": "rust-web",
      "version": "1.1.0",          â† Updated
      "sha256": "pack-hash-here",
      "source": "github:...",
      "files": {
        "src/main.rs": "rust-web@1.1.0",
        "Cargo.toml":  "rust-web@1.1.0"
      }
    }]
  }

Step 9: Report Results
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  âœ“ Updated rust-web: 1.0.0 â†’ 1.1.0

  Files updated:
    âœ“ src/main.rs
    âœ“ Cargo.toml

  Files preserved:
    âœ“ src/custom.rs (manual edit)

  Conflicts: 0
  Manual review needed: 0

  Next steps:
    - Run tests: cargo test
    - Review changes: git diff
    - Commit: git add . && git commit -m "Update rust-web to 1.1.0"
```

---

## Conflict Resolution Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SCENARIO: Conflicting Update                                    â”‚
â”‚           User edited src/main.rs, pack also updated it         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Detection:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Baseline (1.0.0):  hash="abc123"  â† Last known good state
  Current:           hash="manual1" â† User made changes
  New (1.1.0):       hash="xyz789"  â† Pack made changes

  CONFLICT: Both user and pack modified same file

Resolution Options:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Option 1: Auto-Merge (Non-overlapping regions)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Baseline:                              â”‚
  â”‚   1  use actix_web;                    â”‚
  â”‚   2  fn main() { ... }                 â”‚
  â”‚   3  fn helper() { ... }               â”‚
  â”‚                                         â”‚
  â”‚ User changes (lines 3-5):              â”‚
  â”‚   3  fn helper() { println!("new"); }  â”‚
  â”‚   4  fn custom() { ... }               â”‚
  â”‚   5                                     â”‚
  â”‚                                         â”‚
  â”‚ Pack changes (lines 1-2):              â”‚
  â”‚   1  use actix_web;                    â”‚
  â”‚   1+ use tracing;                      â”‚
  â”‚   2  fn main() {                       â”‚
  â”‚        tracing::init();                â”‚
  â”‚   }                                     â”‚
  â”‚                                         â”‚
  â”‚ Merged result:                         â”‚
  â”‚   1  use actix_web;                    â”‚
  â”‚   2  use tracing;            â† Pack    â”‚
  â”‚   3  fn main() {             â† Pack    â”‚
  â”‚        tracing::init();      â† Pack    â”‚
  â”‚   }                          â† Pack    â”‚
  â”‚   6  fn helper() {           â† User    â”‚
  â”‚        println!("new");      â† User    â”‚
  â”‚   }                                     â”‚
  â”‚   7  fn custom() { ... }     â† User    â”‚
  â”‚                                         â”‚
  â”‚ âœ“ AUTO-MERGED (non-overlapping)        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Option 2: Manual Resolution (Overlapping regions)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ User changes (lines 2-4):              â”‚
  â”‚   fn main() {                          â”‚
  â”‚     custom_setup();  â† User added      â”‚
  â”‚   }                                     â”‚
  â”‚                                         â”‚
  â”‚ Pack changes (lines 2-4):              â”‚
  â”‚   fn main() {                          â”‚
  â”‚     tracing::init(); â† Pack added      â”‚
  â”‚   }                                     â”‚
  â”‚                                         â”‚
  â”‚ âš  CONFLICT: Same region modified       â”‚
  â”‚                                         â”‚
  â”‚ Actions:                                â”‚
  â”‚   1. Create conflict markers:          â”‚
  â”‚      <<<<<<< USER (manual edit)        â”‚
  â”‚      custom_setup();                   â”‚
  â”‚      =======                            â”‚
  â”‚      tracing::init();                  â”‚
  â”‚      >>>>>>> PACK (rust-web@1.1.0)     â”‚
  â”‚                                         â”‚
  â”‚   2. Prompt user:                      â”‚
  â”‚      "Conflict in src/main.rs"         â”‚
  â”‚      "Options:"                        â”‚
  â”‚      "  [k]eep user changes"           â”‚
  â”‚      "  [a]ccept pack changes"         â”‚
  â”‚      "  [m]erge manually"              â”‚
  â”‚      "  [s]kip this file"              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Option 3: Preserve Strategy (Conservative)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ If --merge-strategy=preserve:          â”‚
  â”‚                                         â”‚
  â”‚ Never overwrite manual edits           â”‚
  â”‚                                         â”‚
  â”‚ Actions:                                â”‚
  â”‚   1. Keep user version as-is           â”‚
  â”‚   2. Save pack version to:             â”‚
  â”‚      src/main.rs.ggen-new              â”‚
  â”‚   3. Notify user:                      â”‚
  â”‚      "src/main.rs updated by pack"     â”‚
  â”‚      "Review: src/main.rs.ggen-new"    â”‚
  â”‚      "Apply: mv src/main.rs.ggen-new"  â”‚
  â”‚                  "  src/main.rs"       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Region Tracking Implementation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Region Markers in Generated Files                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Generated Rust file (src/main.rs):

1  // @ggen:generated-start pack=rust-web version=1.1.0
2  use actix_web::{web, App, HttpServer};
3  use tracing_subscriber;
4
5  #[actix_web::main]
6  async fn main() -> std::io::Result<()> {
7      tracing_subscriber::init();
8
9      HttpServer::new(|| {
10         App::new()
11             .route("/", web::get().to(index))
12     })
13     .bind(("127.0.0.1", 8080))?
14     .run()
15     .await
16 }
17 // @ggen:generated-end
18
19 // @ggen:manual-edit-start
20 /// Custom user function
21 fn custom_handler() -> &'static str {
22     "Hello from custom code!"
23 }
24 // @ggen:manual-edit-end
25
26 // @ggen:generated-start pack=rust-web version=1.1.0
27 async fn index() -> &'static str {
28     "Hello, world!"
29 }
30 // @ggen:generated-end

Parsed into regions:
{
  "path": "src/main.rs",
  "regions": [
    {
      "type": "generated",
      "start": 1,
      "end": 17,
      "pack": "rust-web",
      "version": "1.1.0"
    },
    {
      "type": "manual",
      "start": 19,
      "end": 24
    },
    {
      "type": "generated",
      "start": 26,
      "end": 30,
      "pack": "rust-web",
      "version": "1.1.0"
    }
  ]
}

During update:
  - Generated regions (lines 1-17, 26-30) â†’ Replaced with new pack version
  - Manual regions (lines 19-24)          â†’ Preserved exactly
```

---

## Watch Mode Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Watch Mode: Continuous Pack Monitoring                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

$ ggen watch --packs

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        WATCH LOOP                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Poll registry      â”‚ â† Every 5 minutes (configurable)
    â”‚ for pack updates   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€ No updates â†’ Continue polling
         â”‚
         â–¼ Updates found
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Check ggen.lock    â”‚
    â”‚ rust-web: 1.0.0    â”‚
    â”‚ Registry: 1.1.0    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Update available
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Prompt user:       â”‚
    â”‚                    â”‚
    â”‚ "Update available: â”‚
    â”‚  rust-web 1.1.0"   â”‚
    â”‚                    â”‚
    â”‚ [y]es / [n]o /     â”‚
    â”‚ [a]lways / [i]gnoreâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€ [n]o â†’ Continue polling
         â”œâ”€â”€â”€ [i]gnore â†’ Add to ignore list
         â”œâ”€â”€â”€ [a]lways â†’ Auto-apply future updates
         â”‚
         â–¼ [y]es selected
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Run pack update    â”‚
    â”‚ (three-way merge)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€ Success â†’ Notify + Continue
         â”‚
         â–¼ Conflicts detected
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Pause watch mode   â”‚
    â”‚ Prompt for manual  â”‚
    â”‚ conflict resolutionâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Conflicts resolved
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Resume polling     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚
                    â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ Monitor filesystem â”‚ â† Detect ggen.lock changes
               â”‚ for external       â”‚   from git pull, manual edits
               â”‚ changes            â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

This architecture provides a complete visual guide to how packs will evolve from isolated scaffolding tools into a living project dependency system.
