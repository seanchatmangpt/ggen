{
  "$schema": "https://claude.ai/schemas/settings-v1.json",
  "$version": "1.0.0-2026",
  "$comment": "ggen project settings - 2026 best practices with EPIC 9, MCP servers, and poka-yoke patterns",

  "permissions": {
    "allow": [
      "Read",
      "Edit",
      "Write",
      "Glob",
      "Grep",
      "Task",
      "TodoWrite",
      "NotebookEdit",
      "Skill",
      "SlashCommand",
      "Bash(cargo make:*)",
      "Bash(git:status)",
      "Bash(git:log:*)",
      "Bash(git:diff:*)",
      "Bash(git:show:*)",
      "Bash(git:branch:*)",
      "Bash(git:add:*)",
      "Bash(git:commit:*)",
      "Bash(git:push:*)",
      "Bash(git:pull:*)",
      "Bash(git:checkout:*)",
      "Bash(gh:*)",
      "Bash(cargo add:*)",
      "Bash(cargo search:*)",
      "Bash(ggen:*)",
      "Bash(ls:*)",
      "Bash(pwd)",
      "Bash(which:*)",
      "Bash(chmod:+x:*)",
      "Bash(mkdir:*)",
      "Bash(echo:*)",
      "Bash(cat:*)",
      "Bash(head:*)",
      "Bash(tail:*)",
      "Bash(wc:*)",
      "Bash(find:.specify/*)",
      "Bash(tree:*)"
    ],
    "deny": [
      ".env",
      ".env.local",
      ".env.production",
      "secrets.json",
      "*.pem",
      "*.key",
      "*.crt",
      "private_keys/",
      ".anthropic/",
      ".openai/",
      ".github/workflows/secrets.yml",
      "credentials.json",
      "config/secrets/*",
      "*.p12",
      "*.pfx",
      "id_rsa*",
      "id_ecdsa*",
      "id_ed25519*",
      "known_hosts",
      ".ssh/",
      ".gnupg/",
      "Bash(rm:-rf:/*)",
      "Bash(rm:-rf:/home/*)",
      "Bash(rm:-rf:/usr/*)",
      "Bash(dd:*)",
      "Bash(mkfs:*)",
      "Bash(fdisk:*)",
      "Bash(parted:*)",
      "Bash(sudo:*)",
      "Bash(su:*)",
      "Bash(chmod:777:*)",
      "Bash(chown:*)",
      "Bash(systemctl:*)",
      "Bash(service:*)",
      "Bash(shutdown:*)",
      "Bash(reboot:*)",
      "Bash(init:*)"
    ],
    "ask": [
      "Bash(rm:*)",
      "Bash(mv:*)",
      "Bash(git:push:--force*)",
      "Bash(git:push:-f:*)",
      "Bash(git:reset:--hard:*)",
      "Bash(git:clean:-fdx:*)",
      "Bash(cargo:clean)",
      "Write(Cargo.toml)",
      "Edit(Cargo.toml)",
      "Write(.gitignore)",
      "Write(.github/workflows/*)"
    ],
    "additional_directories": [
      "docs/",
      "benches/",
      ".specify/",
      "templates/",
      "examples/",
      "marketplace/",
      "scripts/",
      ".claude/"
    ],
    "protected_paths": [
      "Cargo.toml",
      "Cargo.lock",
      "CLAUDE.md",
      ".gitignore",
      ".github/workflows/*",
      "Makefile.toml",
      ".specify/ontology/*",
      ".specify/memory/constitution.ttl",
      ".claude/settings.json"
    ],
    "default_mode": "allow",
    "path_traversal_prevention": true,
    "symlink_resolution": "safe"
  },
  "hooks": {
    "SessionStart": [
      {
        "matcher": "",
        "description": "Initialize environment, check dependencies, load project context",
        "hooks": [
          {
            "type": "command",
            "command": "./.claude/hooks/session-start.sh",
            "timeout": 30,
            "description": "Initialize Rust environment, check cargo make, validate dependencies"
          },
          {
            "type": "prompt",
            "prompt": "Session initialized. Project: ggen v5.2.0. Read CLAUDE.md for constitution. Key reminders: (1) cargo make ONLY, (2) EPIC 9 for non-trivial tasks, (3) /speckit-verify before implementation, (4) Collect receipts not narratives.",
            "timeout": 5
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Write|Edit",
        "description": "Poka-yoke: Prevent writing to protected paths or secrets",
        "hooks": [
          {
            "type": "command",
            "command": "./.claude/hooks/pre-tool-safety-check.sh",
            "timeout": 10,
            "description": "Check path traversal, validate file permissions, prevent secret exposure"
          }
        ]
      },
      {
        "matcher": "Bash(cargo:(?!make).*)",
        "description": "Andon signal: Detect direct cargo usage (violation)",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "üö® ANDON RED: Direct cargo command detected. Constitution violation. Use 'cargo make [target]' instead. This is a STOP-THE-LINE signal. Correct before proceeding.",
            "timeout": 5
          }
        ]
      },
      {
        "matcher": "Bash(git:push:--force.*|git:push:-f:.*)",
        "description": "Safety gate: Warn on force push",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "‚ö†Ô∏è Force push detected. Verify: (1) Not pushing to main/master, (2) Team is aware, (3) Have local backup. Proceed only if all verified.",
            "timeout": 10
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Bash",
        "description": "Andon signal detection: Parse bash output for errors/warnings",
        "hooks": [
          {
            "type": "command",
            "command": "./.claude/hooks/post-bash-validation.sh",
            "timeout": 5,
            "description": "Detect error[E...], FAILED, warnings, clippy violations"
          }
        ]
      },
      {
        "matcher": "Bash(cargo make:test.*)",
        "description": "Test receipt generation",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Generate receipt: Parse test output for pass/fail counts, timing, coverage. Format: [Receipt] cargo make test: ‚úì (X/Y pass, Zs)",
            "timeout": 5
          }
        ]
      },
      {
        "matcher": "Bash(cargo make:lint.*)",
        "description": "Lint receipt generation",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Generate receipt: Parse clippy output for violations. Format: [Receipt] cargo make lint: ‚úì (0 violations) or ‚ö†Ô∏è (N violations)",
            "timeout": 5
          }
        ]
      },
      {
        "matcher": "Write|Edit",
        "description": "Track file changes for commit preparation",
        "hooks": [
          {
            "type": "command",
            "command": "./.claude/hooks/post-write-tracker.sh",
            "timeout": 5,
            "description": "Log modified files for commit message generation"
          }
        ]
      }
    ],
    "Stop": [
      {
        "matcher": "",
        "description": "Verify work complete before ending session",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Before stopping, verify:\n1. All tests pass? (cargo make test)\n2. Lint clean? (cargo make lint)\n3. Uncommitted changes? (git status)\n4. Outstanding TODOs?\n5. Receipts collected?\n\nIf issues exist, explain what needs resolution before stopping.",
            "timeout": 30
          }
        ]
      }
    ],
    "UserPromptSubmit": [
      {
        "matcher": "",
        "description": "Validate user prompt for ambiguity and specification requirements",
        "hooks": [
          {
            "type": "command",
            "command": "./.claude/hooks/user-prompt-validation.sh",
            "timeout": 5,
            "description": "Detect vague requirements: 'maybe', 'probably', 'should work'"
          }
        ]
      },
      {
        "matcher": "implement|create|add|build",
        "description": "Specification closure gate for implementation requests",
        "hooks": [
          {
            "type": "command",
            "command": "./.claude/hooks/pre-specification-check.sh",
            "timeout": 10,
            "description": "Check if .ttl specification exists before implementation"
          },
          {
            "type": "prompt",
            "prompt": "Implementation request detected. Constitution requires specification closure. Before proceeding: (1) Does .specify/specs/NNN-feature/*.ttl exist? (2) Run /speckit-verify to check closure. If spec incomplete, STOP and clarify with user.",
            "timeout": 10
          }
        ]
      }
    ],
    "PostTask": [
      {
        "matcher": "collision",
        "description": "EPIC 9 Phase 3: Collision detection validation",
        "hooks": [
          {
            "type": "command",
            "command": "./.claude/hooks/post-collision-detection.sh",
            "timeout": 30,
            "description": "Analyze agent outputs for structural and semantic overlaps"
          }
        ]
      },
      {
        "matcher": "convergence",
        "description": "EPIC 9 Phase 4: Convergence validation",
        "hooks": [
          {
            "type": "command",
            "command": "./.claude/hooks/convergence-validation.sh",
            "timeout": 30,
            "description": "Validate selection pressure applied, best solution selected"
          }
        ]
      },
      {
        "matcher": "receipt",
        "description": "Deterministic validation: Collect and format receipts",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Receipt collection requested. Gather evidence:\n[Receipt] Compilation: cargo make check\n[Receipt] Tests: cargo make test (X/Y pass)\n[Receipt] Lint: cargo make lint (N violations)\n[Receipt] SLO: Times within targets?\nFormat as structured output, NO narratives.",
            "timeout": 15
          }
        ]
      }
    ],
    "PreCommit": [
      {
        "matcher": "",
        "description": "Quality gate before git commit",
        "hooks": [
          {
            "type": "command",
            "command": "cargo make pre-commit",
            "timeout": 120,
            "description": "Run format + lint + test-unit (quality gate)"
          },
          {
            "type": "prompt",
            "prompt": "Pre-commit validation complete. Check receipts before proceeding with commit.",
            "timeout": 5
          }
        ]
      }
    ]
  },
  "mcp_servers": {
    "$comment": "Model Context Protocol servers - stubs for future integration",
    "enabled": false,
    "servers": {
      "filesystem": {
        "command": "mcp-server-filesystem",
        "args": ["/home/user/ggen"],
        "env": {},
        "description": "Filesystem access via MCP",
        "disabled": true
      },
      "github": {
        "command": "mcp-server-github",
        "args": [],
        "env": {
          "GITHUB_TOKEN": "${GITHUB_TOKEN}"
        },
        "description": "GitHub API access (issues, PRs, repos)",
        "disabled": true
      },
      "web-search": {
        "command": "mcp-server-brave-search",
        "args": [],
        "env": {
          "BRAVE_API_KEY": "${BRAVE_API_KEY}"
        },
        "description": "Web search via Brave API",
        "disabled": true
      },
      "postgres": {
        "command": "mcp-server-postgres",
        "args": ["postgresql://localhost:5432/ggen"],
        "env": {},
        "description": "PostgreSQL database access for testing",
        "disabled": true
      },
      "openapi": {
        "command": "mcp-server-openapi",
        "args": [],
        "env": {},
        "description": "OpenAPI spec generation and validation",
        "disabled": true
      },
      "sparql": {
        "command": "mcp-server-sparql",
        "args": ["http://localhost:7878/query"],
        "env": {},
        "description": "SPARQL endpoint for RDF queries (Oxigraph)",
        "disabled": true
      }
    },
    "usage_notes": [
      "MCP servers provide external capabilities via standardized protocol",
      "Enable specific servers by setting 'disabled: false'",
      "Requires MCP-compatible servers installed in PATH",
      "Environment variables use ${VAR} syntax, resolved at runtime"
    ]
  },
  "environment": {
    "env": {
      "RUST_BACKTRACE": "1",
      "RUST_LOG": "info",
      "CARGO_TERM_COLOR": "always",
      "CARGO_INCREMENTAL": "1",
      "CARGO_PROFILE_DEV_DEBUG": "1",
      "CARGO_PROFILE_TEST_DEBUG": "1",
      "NODE_ENV": "development",
      "RUSTFLAGS": "-D warnings",
      "RUST_MIN_STACK": "8388608",
      "GGEN_LOG_LEVEL": "info",
      "GGEN_CACHE_DIR": ".ggen/cache",
      "GGEN_CONFIG_DIR": ".ggen",
      "OXIGRAPH_STORE_PATH": ".specify/.oxigraph",
      "OPENTELEMETRY_ENABLED": "false",
      "CI": "false"
    },
    "api_key_helper": "./.claude/helpers/api-key-helper.sh",
    "bash_init": "./.claude/helpers/bash-init.sh",
    "shell": "/bin/bash",
    "working_directory": "/home/user/ggen"
  },
  "tools_and_model": {
    "model": "claude-sonnet-4-5-20250929",
    "fallback_model": "claude-haiku-4-5-20251001",
    "output_style": "structured",
    "temperature": 0.0,
    "max_tokens": 4096,
    "streaming": true,
    "tool_preferences": {
      "prefer_parallel_calls": true,
      "batch_independent_operations": true,
      "max_parallel_tools": 10
    },
    "reasoning_budget": {
      "enabled": true,
      "default_budget": 10000,
      "complex_task_budget": 30000
    }
  },
  "status_line": {
    "enabled": true,
    "format": "ggen v${version} | ${branch} | ${crate_count} crates | ${test_status} | ${slo_status}",
    "update_interval": 5,
    "show_git_status": true,
    "show_build_status": true,
    "show_test_status": true,
    "indicators": {
      "clean": "‚úì",
      "dirty": "‚ö†",
      "error": "‚úó",
      "building": "‚ãØ",
      "testing": "‚ãØ"
    }
  },
  "plugins": {
    "enabled_plugins": [
      "rust-analyzer",
      "cargo-clippy",
      "cargo-make",
      "test-runner",
      "benchmark-runner",
      "rdf-validator",
      "sparql-query"
    ],
    "plugin_config": {
      "rust-analyzer": {
        "check_on_save": true,
        "cargo_features": "all"
      },
      "cargo-clippy": {
        "all_features": true,
        "warnings_as_errors": true
      }
    }
  },
  "project_metadata": {
    "name": "ggen",
    "version": "5.2.0",
    "description": "Language-agnostic, deterministic code generation CLI. Ontologies + RDF ‚Üí reproducible code projections.",
    "philosophy": "Type-first thinking, zero-cost abstractions, memory safety, deterministic outputs",
    "required_reading": [
      "CLAUDE.md - Project constitution and philosophy",
      ".claude/README.md - Claude Code configuration guide",
      ".specify/ - RDF specification system (source of truth)"
    ],
    "repository": "https://github.com/seanchatmangpt/ggen",
    "license": "MIT",
    "primary_language": "Rust",
    "rust_version": "1.91.1",
    "msrv": "1.75+",
    "edition": "2021",
    "workspace_crates": 17,
    "active_crates": 14,
    "tech_stack": [
      "Rust (workspace)",
      "Tokio 1.47 (async runtime)",
      "Oxigraph 0.5.1 (RDF + SPARQL)",
      "Tera 1.20 (templates)",
      "chicago-tdd-tools 1.4.0 (testing)",
      "criterion 0.7 (benchmarks)",
      "testcontainers 0.25 (E2E with gVisor)"
    ],
    "methodologies": [
      "SPARC (Specification, Pseudocode, Refinement, Completion)",
      "Chicago TDD (state-based testing)",
      "DfLSS (Design for Lean Six Sigma)",
      "Poka-Yoke (error-proofing)",
      "EPIC 9 (parallel atomic cognitive cycle)"
    ],
    "key_features": [
      "ggen sync - Code generation from RDF specifications",
      "ggen init - Project scaffolding with templates",
      "Marketplace - 70+ pre-built packages",
      "E2E testing with gVisor sandboxing",
      "SLO enforcement on all operations"
    ]
  },
  "execution_model": {
    "paradigm": "parallel-first",
    "specification_required": true,
    "default_task_type": "non-trivial",
    "trivial_task_whitelist": [
      "single_file_read",
      "run_existing_script",
      "display_help",
      "factual_question",
      "git_status_check",
      "simple_query"
    ],
    "concurrency": {
      "max_parallel_tasks": 10,
      "batching_required": true,
      "single_message_rule": "1 MESSAGE = ALL RELATED OPERATIONS"
    }
  },
  "epic9": {
    "enabled": true,
    "description": "Atomic Cognitive Cycle: Fan-Out ‚Üí Independent Construction ‚Üí Collision Detection ‚Üí Convergence ‚Üí Refactoring ‚Üí Closure",
    "default_agents": 10,
    "collision_detection": "required",
    "convergence_method": "selection_pressure",
    "mandatory_phases": [
      "fan_out",
      "independent_construction",
      "collision_detection",
      "convergence",
      "refactoring",
      "closure"
    ],
    "failure_on_incomplete": true,
    "skip_conditions": [
      "Task is trivial (reading one file, running one script)",
      "Task is purely informational (help, status check)",
      "User explicitly requests sequential execution"
    ],
    "speedup_target": "2.8x-4.4x vs sequential",
    "benefits": [
      "Multiple perspectives prevent blind spots",
      "High confidence through collision detection",
      "Better coverage (agents hit different parts)",
      "No iteration needed if spec is closed"
    ]
  },
  "big_bang_80_20": {
    "enabled": true,
    "description": "Single-pass construction in low-entropy domains",
    "specification_closure_required": true,
    "iteration_signal_defect": true,
    "monoidal_composition": true,
    "workflow": [
      "1. Specification closure verification (mandatory)",
      "2. Single-pass construction (one implementation)",
      "3. Validation receipts (deterministic evidence)"
    ],
    "gates": {
      "before_implementation": "/speckit-verify",
      "incomplete_spec_action": "STOP - clarify with user, update .ttl",
      "only_proceed_when": "closure score = 100%"
    }
  },
  "deterministic_validation": {
    "enabled": true,
    "description": "Evidence-first validation: receipts replace review, benchmarks replace narratives",
    "required_receipts": [
      "compilation_success",
      "all_tests_pass",
      "lint_clean",
      "slo_compliance",
      "no_warnings",
      "specification_coverage",
      "mutation_testing_score"
    ],
    "receipt_format": "[Receipt] {target}: {status} ({details})",
    "examples": [
      "[Receipt] cargo make check: ‚úì",
      "[Receipt] cargo make test: ‚úì (347/347 pass, 28s)",
      "[Receipt] cargo make lint: ‚úì (0 violations)",
      "[Receipt] SLO compliance: ‚úì (check 4.2s, test 28s, lint 58s)",
      "[Receipt] Specification coverage: 95%"
    ],
    "prohibited_narratives": [
      "Code looks good",
      "Tests should pass",
      "Performance is fine",
      "I think this works"
    ]
  },
  "quality_gates": {
    "enabled": true,
    "description": "Poka-yoke error-proofing gates at critical points",
    "gates": {
      "pre_implementation": {
        "name": "Specification Closure Gate",
        "command": "/speckit-verify",
        "required": true,
        "failure_action": "STOP - specification incomplete"
      },
      "pre_commit": {
        "name": "Quality Gate",
        "command": "cargo make pre-commit",
        "required": true,
        "failure_action": "STOP - fix issues before commit",
        "timeout": 120
      },
      "pre_push": {
        "name": "CI Gate",
        "command": "cargo make ci",
        "required": false,
        "failure_action": "WARN - CI will fail",
        "timeout": 300
      },
      "pre_release": {
        "name": "Full Validation Gate",
        "commands": [
          "cargo make check",
          "cargo make test",
          "cargo make lint",
          "cargo make bench",
          "/test-audit",
          "/review-errors"
        ],
        "required": true,
        "failure_action": "STOP - release blocked"
      }
    }
  },
  "andon_signals": {
    "enabled": true,
    "description": "Stop-the-line signals from Toyota Production System",
    "signals": {
      "RED": {
        "triggers": [
          "error[E...]",
          "test ... FAILED",
          "panicked at",
          "SIGABRT",
          "segmentation fault"
        ],
        "action": "STOP - Fix immediately before proceeding",
        "priority": "critical"
      },
      "YELLOW": {
        "triggers": [
          "warning:",
          "clippy::",
          "deprecated",
          "unused",
          "TODO",
          "FIXME"
        ],
        "action": "Investigate before release",
        "priority": "high"
      },
      "GREEN": {
        "triggers": [
          "test result: ok",
          "Finished release",
          "0 violations"
        ],
        "action": "Continue safely",
        "priority": "info"
      }
    },
    "workflow": "Monitor ‚Üí Stop ‚Üí Investigate ‚Üí Fix ‚Üí Verify ‚Üí Cleared ‚úì"
  },
  "slo_targets": {
    "enabled": true,
    "description": "Service Level Objectives for all operations",
    "targets": {
      "first_build": "‚â§15s",
      "incremental_build": "‚â§2s",
      "cargo_make_check": "‚â§5s",
      "cargo_make_test": "‚â§30s (escalate to 120s on contention)",
      "cargo_make_lint": "‚â§60s",
      "rdf_processing": "‚â§5s for 1k+ triples",
      "generation": "‚â§5s",
      "generation_memory": "‚â§100MB",
      "cli_scaffolding": "‚â§3s end-to-end"
    },
    "reproducibility": "100% reproducible outputs",
    "enforcement": "cargo make enforces timeouts"
  },
  "cargo_make_protocol": {
    "enabled": true,
    "description": "MANDATORY: Always use cargo make, NEVER direct cargo commands",
    "rule": "cargo make [target] ONLY",
    "prohibited": [
      "cargo check",
      "cargo test",
      "cargo build",
      "cargo run",
      "cargo clippy",
      "cargo fmt"
    ],
    "allowed": [
      "cargo make check",
      "cargo make test",
      "cargo make test-unit",
      "cargo make lint",
      "cargo make pre-commit",
      "cargo make ci",
      "cargo make bench",
      "cargo make slo-check"
    ],
    "rationale": "Enforces timeouts, quality gates, andon signals, SLO compliance"
  },
  "error_handling_protocol": {
    "enabled": true,
    "description": "Production code must use Result<T, E>, NO unwrap/expect",
    "rules": {
      "production_code": {
        "allowed": ["Result<T, E>", "?", "map_err", "and_then", "or_else"],
        "prohibited": ["unwrap()", "expect()"],
        "exemptions": []
      },
      "test_code": {
        "allowed": ["unwrap()", "expect()", "Result<T, E>", "panic!"],
        "rationale": "Tests SHOULD panic on failure for fast feedback",
        "scope": ["#[cfg(test)]", "#[test]", "tests/", "benches/"]
      }
    },
    "enforcement": "/review-errors command audits all code"
  },
  "rdf_specification_protocol": {
    "enabled": true,
    "description": "RDF-first: TTL is source of truth, markdown is generated",
    "rules": {
      "edit_ttl_only": "ALWAYS edit .ttl files, NEVER edit .md files",
      "regenerate_md": "Use ggen render to regenerate markdown from TTL",
      "specification_location": ".specify/specs/NNN-feature/",
      "evidence_location": ".specify/specs/NNN-feature/evidence/",
      "ontology_location": ".specify/ontology/",
      "constitution": ".specify/memory/constitution.ttl"
    },
    "workflow": [
      "1. Create/edit .ttl specification",
      "2. Validate with /speckit-check",
      "3. Verify closure with /speckit-verify",
      "4. Regenerate markdown (if needed)",
      "5. Implement from TTL (NOT from markdown)"
    ]
  },
  "session_configuration": {
    "auto_load_skills": true,
    "auto_load_agents": true,
    "auto_discover_commands": true,
    "session_timeout": 3600,
    "idle_timeout": 1800,
    "max_conversation_length": 100,
    "context_window": 200000,
    "enable_file_watching": false,
    "enable_auto_completion": true,
    "enable_inline_diagnostics": true
  },
  "observability": {
    "enabled": true,
    "logging": {
      "level": "info",
      "format": "json",
      "output": "stdout",
      "file": ".claude/logs/session.log",
      "rotate": true,
      "max_size_mb": 100
    },
    "tracing": {
      "enabled": false,
      "backend": "opentelemetry",
      "endpoint": "http://localhost:4317",
      "sample_rate": 0.1
    },
    "metrics": {
      "enabled": true,
      "track_tool_usage": true,
      "track_execution_time": true,
      "track_token_usage": true,
      "track_error_rate": true
    }
  },
  "security": {
    "enabled": true,
    "path_traversal_prevention": true,
    "symlink_resolution": "safe",
    "secret_detection": true,
    "dangerous_command_blocking": true,
    "max_file_size_mb": 10,
    "allowed_file_extensions": [
      ".rs",
      ".toml",
      ".md",
      ".json",
      ".yaml",
      ".yml",
      ".ttl",
      ".rdf",
      ".sparql",
      ".sh",
      ".js",
      ".ts",
      ".txt"
    ]
  }
}
