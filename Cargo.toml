[package]
name = "ggen"
version = "2.6.0"
authors = ["Sean Chatman <sean@chatmangpt.com>"]
edition = "2021"
repository = "https://github.com/seanchatmangpt/ggen"
readme = "README.md"
license = "MIT"
keywords = ["cli", "code-generation", "rdf", "templates"]
homepage = "https://github.com/seanchatmangpt/ggen"
categories = ["development-tools", "command-line-utilities"]
description = """
ggen is a deterministic, language-agnostic code generation framework that treats software artifacts as projections of knowledge graphs.
"""

[workspace]
members = [
  "crates/ggen-utils",
  "crates/ggen-cli",
  "crates/ggen-domain",
  "crates/ggen-core",
  "crates/ggen-ai",
  "crates/ggen-marketplace",
  "examples/frontmatter-cli",
  "examples/natural-market-search",
  "examples/ai-template-project",
  "crates/ggen-node",
]
exclude = [
  "examples/rust-cli-lifecycle",
  "examples/marketplace-demo/generated",
  "marketplace/packages/workflow-engine-cli",
]
resolver = "2" # Use new resolver for better dependency resolution

# Workspace-wide dependencies for version consistency
[workspace.dependencies]
tokio = { version = "1.47", features = ["full"] }
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
anyhow = "1.0"
thiserror = "2.0"
async-trait = "0.1"
tracing = "0.1"
tracing-subscriber = { version = "0.3", features = [
  "env-filter",
  "json",
  "ansi",
] }
log = "0.4.28"
clap = { version = "4.5", features = ["derive"] }
clap-noun-verb = "3.4.0"
clap-noun-verb-macros = "3.4.0"
once_cell = "1.19"
reqwest = { version = "0.12", features = ["json", "rustls-tls"] }
tempfile = "3.23"
chrono = { version = "0.4", features = ["serde"] }
futures = "0.3"
futures-util = "0.3"
uuid = { version = "1.18", features = ["v4", "serde"] }
tera = "1.20"
oxigraph = "0.5.1"
toml = "0.9"
serde_yaml = "0.9"
regex = "1.12"
rayon = "1.11"

# OpenTelemetry dependencies
opentelemetry = "0.21"
opentelemetry-otlp = "0.14"
opentelemetry_sdk = { version = "0.21", features = ["rt-tokio"] }
tracing-opentelemetry = "0.22"

# CLI Enhancement libraries
indicatif = "0.18"
console = "0.16"

# Testing libraries
proptest = "1.8"
chicago-tdd-tools = "1.3.0"  # Updated from 1.2.0 to 1.3.0

# Force base64 version to resolve duplicate dependency issue
# config -> ron -> base64 0.21.7 conflicts with reqwest -> base64 0.22.1
base64 = "0.22"

# Patch removed - was causing conflicts with same source

# Maximized linting configuration (Rust 1.78+)
# **Poka-Yoke Design**: Warnings are treated as errors to prevent defects at compile time.
# Type-first thinking: Compiler enforces correctness. If it compiles, invariants are enforced.
# Prevention is better than detection - catch issues at compile time, not runtime.
# Note: Individual lint configuration is done via attributes in code
# This section sets global lint levels
[workspace.lints.rust]
warnings = "deny"  # Poka-Yoke: Prevent warnings at compile time
unsafe_code = "deny"
missing_docs = "warn"  # Documentation warnings are less critical than code quality

[workspace.lints.clippy]
# **Poka-Yoke Design**: Deny warnings to prevent defects at compile time.
# Type-first thinking: Use compiler as design tool to enforce correctness.
# Prevention is better than detection - catch issues at compile time, not runtime.
# Set lint groups to deny level for poka-yoke error prevention
all = { level = "deny", priority = -1 }
pedantic = { level = "deny", priority = -1 }
nursery = { level = "deny", priority = -1 }
cargo = { level = "deny", priority = -1 }

# Deny critical lints for Poka-Yoke (error prevention)
# These have higher priority (0) and will override the groups
unwrap_used = "deny"
expect_used = "deny"
panic = "deny"
todo = "deny"
unimplemented = "deny"

# Allow multiple crate versions due to complex dependency tree
multiple_crate_versions = "allow"

[features]
nightly = ["ggen-utils/nightly"]
termlog = ["ggen-utils/termlog"]
journald = ["ggen-utils/journald"]
syslog = ["ggen-utils/syslog"]
london_tdd = []

[dependencies]
ggen-utils = { path = "crates/ggen-utils", version = "2.6.0" }
ggen-cli-lib = { path = "crates/ggen-cli", version = "2.6.0" }
ggen-core = { path = "crates/ggen-core", version = "2.6.0" }
ggen-ai = { path = "crates/ggen-ai", version = "2.6.0" }
human-panic = "2.0.3"
better-panic = "0.3.0"
log = "0.4.28"
env_logger = "0.11"
tokio = { version = "1.47", features = ["full"] }
anyhow = "1.0"
chrono = { version = "0.4", features = ["serde"] }
serde_json = "1.0"
serde_yaml = "0.9"
clap = { version = "4.5", features = ["derive"] }
tempfile = "3.23"
tera = "1.20"
async-trait = "0.1"
serde = { version = "1.0", features = ["derive"] }
uuid = { version = "1.18", features = ["v4"] }
genai = "0.4"
tracing-subscriber = "0.3"

# Example definitions removed - examples now discovered automatically by Cargo

[dev-dependencies]
assert_cmd = "2.0.17"
predicates = "3.1.3"
serde_json = "1.0"
tempfile = "3.23"
anyhow = "1.0"
chrono = { version = "0.4", features = ["serde"] }
ggen-domain = { path = "crates/ggen-domain" }
oxigraph = "0.5.1"
# BDD testing framework
cucumber = { version = "0.21", features = ["macros"] }
assert_fs = "1.1"
mockito = "1.7"
insta = "1.43"
serial_test = "3.2"
md5 = "0.8"
shell-words = "1.1"
# E2E test dependencies
toml = "0.9"
reqwest = { version = "0.12", features = ["blocking", "json"] }
genai = "0.4"
proptest.workspace = true
chicago-tdd-tools = { workspace = true, features = ["testing-extras", "testcontainers", "otel"] }
# Cleanroom integration for CLI testing
clnrm = "0.1.0"
testcontainers = "0.25"
testcontainers-modules = "0.13"
rand = "0.8"
mockall = "0.13"
fake = "2.9"
opentelemetry.workspace = true
opentelemetry-otlp.workspace = true
opentelemetry_sdk.workspace = true
futures.workspace = true
ggen-marketplace = { path = "crates/ggen-marketplace", version = "2.6.0" }
tracing.workspace = true
tracing-subscriber.workspace = true
tracing-opentelemetry.workspace = true
# Performance benchmarking
criterion = { version = "0.7", features = ["html_reports"] }
once_cell = "1.20"
lazy_static = "1.4"
fastrand = "2.3"

[profile.dev]
opt-level = 0
debug = true
rpath = false
lto = false
debug-assertions = true
codegen-units = 256          # More parallel compilation units = faster builds
incremental = true           # Enable incremental compilation
split-debuginfo = "unpacked" # Faster debug builds on macOS

[profile.release]
opt-level = 3
debug = false
rpath = false
lto = "thin"             # Thin LTO for faster builds, still optimized
debug-assertions = false
codegen-units = 16       # Balance between speed and optimization
strip = true             # Strip symbols for smaller binaries

[profile.test]
opt-level = 0           # Faster test compilation
debug = true
rpath = false
lto = false
debug-assertions = true
codegen-units = 256     # More parallel compilation
incremental = true      # Enable incremental for tests

[profile.bench]
opt-level = 3
debug = false
rpath = false
lto = true
debug-assertions = false
codegen-units = 1

[[bench]]
name = "runtime_overhead"
harness = false

[[bench]]
name = "async_runtime_benchmarks"
harness = false

[[bench]]
name = "memory_profiling"
harness = false

[[bench]]
name = "quick_runtime_validation"
harness = false

[[bench]]
name = "conventions_performance"
harness = false

[[bench]]
name = "marketplace_performance"
harness = false

[[test]]
name = "testcontainer_marketplace_git_hooks"
path = "tests/integration/testcontainer_marketplace_git_hooks.rs"
required-features = []

[[test]]
name = "full_cycle_container_validation"
path = "tests/integration/full_cycle_container_validation.rs"
required-features = []

[[test]]
name = "nextjs_ontology_sync"
path = "tests/integration/nextjs_ontology_sync.rs"
required-features = []

[[test]]
name = "marketplace_nextjs_ontology_e2e"
path = "tests/integration/marketplace_nextjs_ontology_e2e.rs"
required-features = []

[[test]]
name = "marketplace_package_e2e"
path = "tests/integration/marketplace_package_e2e.rs"
required-features = []
