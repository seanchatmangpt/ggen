[package]
name = "ggen"
version = "0.2.0"
authors = ["Sean Chatman <sean@chatmangpt.com>"]
edition = "2021"
repository = "https://github.com/seanchatmangpt/ggen"
readme = "README.md"
license = "MIT"
keywords = ["cli", "code-generation", "rdf", "templates"]
homepage = "https://github.com/seanchatmangpt/ggen"
categories = ["development-tools", "command-line-utilities"]
description = """
ggen is a deterministic, language-agnostic code generation framework that treats software artifacts as projections of knowledge graphs.
"""

[workspace]
members = [
  # Core system (always compiled)
  "crates/ggen-utils",
  "crates/ggen-cli",
  "crates/ggen-domain",
  "crates/ggen-core",
  "crates/ggen-config",
  "crates/ggen-macros",
  "crates/ggen-dod",           # Domain-driven design patterns (from origin/main)
  "crates/ggen-ontology-core", # Ontology handling layer: RDF/TTL, SPARQL, entity mapping

  # CLI & Validation (always compiled)
  "crates/ggen-cli-validation",
  "crates/ggen-config-clap",

  # Optional: AI orchestration (feature-gated)
  "crates/ggen-ai",            # AI orchestration and multi-provider LLM integration (v5.1.0)
  "crates/ggen-dspy",

  # Optional: Marketplace (feature-gated)
  "crates/ggen-marketplace",

  # Optional: Testing & Quality (feature-gated)
  "crates/ggen-test-audit",    # Feature 004: Test quality audit tooling
  "crates/ggen-test-opt",      # Feature 004: Test optimization tooling
  "crates/ggen-e2e",           # Feature 011: End-to-end testing with testcontainers

  # Optional: Node.js bindings (feature-gated)
  "crates/ggen-node",

  # Optional: RevOps/Monetization (feature-gated)
  "crates/ggen-api",           # RevOps: REST API layer for monetization
  "crates/ggen-auth",          # RevOps: Authentication (OAuth2, JWT, API keys)
  "crates/ggen-payments",      # RevOps: Payment processing (Stripe integration)
  "crates/ggen-saas",          # RevOps: SaaS tier management and quota enforcement

  # Optional: Folk strategy (feature-gated)
  "crates/ggen-folk-strategy", # Folk strategy quantification from opportunity field dynamics

  # Optional: KNHK Systems Integration (feature-gated)
  # NOTE: KNHK crates temporarily excluded due to pre-existing compilation errors
  # "crates/knhk-etl",           # Extract-Transform-Load pipeline
  # "crates/knhk-hot",           # C FFI hot-path optimization
  # "crates/knhk-connectors",    # Connector registry (Kafka, HTTP, etc.)
  # "crates/knhk-lockchain",     # Merkle-linked receipt storage
  # "crates/knhk-otel",          # OpenTelemetry integration
  # "crates/knhk-orchestrator",  # Integration bridge (ETL → KGC-4D → Workflow)

  # Optional: TPS/TAI Systems (feature-gated)
  # NOTE: TPS/TAI crates temporarily excluded due to pre-existing compilation errors
  # "crates/tps-reference",      # Toyota Production System reference implementation
  # "crates/ggen-tps-andon",     # TPS Andon: Visibility, alerting, and diagnostics
  # "crates/tai-testing",        # Production hardening & resilience testing framework
  # "crates/tai-k8s",            # TAI Kubernetes: Deployment, KEDA autoscaling, Istio traffic management
  # "crates/tai-validation",     # SLO/SLA validation, compliance framework, security scanning

  # "playground",
]
exclude = [
  "examples/rust-cli-lifecycle",
  "examples/marketplace-demo/generated",
  "examples/gcp-erlang-autonomics",
  "marketplace/packages/workflow-engine-cli",
  "crates/tps-kaizen",  # Temporarily excluded - has Cargo.toml syntax error
  "crates/tps-reference",  # Temporarily excluded - has compilation errors (pre-existing)
  "crates/ggen-tps-andon",  # Temporarily excluded - depends on tps-reference
  "crates/tai-gcp",  # Temporarily excluded - missing google-authz dependency
  "crates/tai-security",  # Temporarily excluded - has dependency issues
  "crates/tai-resilience",  # Temporarily excluded - has dependency issues
  "crates/tai-cache",  # Temporarily excluded - has dependency issues
  "crates/tai-grpc",  # Temporarily excluded - has dependency issues
  "crates/tai-loadbalancer",  # Temporarily excluded - missing benchmark files
  "crates/tai-testing",  # Temporarily excluded - may have dependency issues
  "crates/tai-k8s",  # Temporarily excluded - may have dependency issues
  "crates/tai-validation",  # Temporarily excluded - may have dependency issues
]
resolver = "2" # Use new resolver for better dependency resolution

# Workspace-wide dependencies for version consistency
[workspace.dependencies]
# Minimal tokio features for CLI/code-generation (80/20 optimization)
# Removed: fs, net, process, sync-mutex, test-util, parking_lot, stats
tokio = { version = "1.47", features = ["macros", "rt-multi-thread", "io-util", "io-std", "sync", "signal", "time"] }
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
anyhow = "1.0"
thiserror = "2.0"
async-trait = "0.1"
tracing = "0.1"
tracing-subscriber = { version = "0.3", features = [
  "env-filter",
  "json",
  "ansi",
] }
clap = { version = "4.5", features = ["derive"] }
clap-noun-verb = "5.0.0"
clap-noun-verb-macros = "5.0.0"
once_cell = "1.19"
reqwest = { version = "0.12", features = ["blocking", "json", "rustls-tls"] }
tempfile = "3.23"
chrono = { version = "0.4", features = ["serde"] }
futures = "0.3"
futures-util = "0.3"
uuid = { version = "1.18", features = ["v4", "serde"] }
tera = "1.20"
oxigraph = "0.5.1"
toml = "0.9"
serde_yaml = "0.9"
regex = "1.12"
rayon = "1.11"
log = "0.4.28"
sha2 = "0.10"
hex = "0.4"

# E2E testing with testcontainers
testcontainers = "0.25"
testcontainers-modules = "0.13"

# File watching for auto-regeneration
notify = "7.0"
notify-debouncer-full = "0.4"
assert_cmd = "2.0"
predicates = "3.1"

# Workspace-local crates (use workspace = true pattern in workspace members)
# NOTE: v0.2.0 unified release

# Core crates (always available)
ggen-utils = { path = "crates/ggen-utils", version = "0.2.0" }
ggen-core = { path = "crates/ggen-core", version = "0.2.0" }
ggen-config = { path = "crates/ggen-config", version = "0.2.0" }
ggen-cli-validation = { path = "crates/ggen-cli-validation", version = "0.2.0" }
ggen-config-clap = { path = "crates/ggen-config-clap", version = "0.2.0" }
ggen-domain = { path = "crates/ggen-domain", version = "0.2.0" }
ggen-cli-lib = { path = "crates/ggen-cli", version = "0.2.0" }
ggen-macros = { path = "crates/ggen-macros", version = "0.2.0" }
ggen-dod = { path = "crates/ggen-dod", version = "0.2.0" }
ggen-ontology-core = { path = "crates/ggen-ontology-core", version = "0.2.0" }

# Optional: AI integration (available in workspace.dependencies for member crates)
# Member crates that depend on these use: ggen-ai.workspace = true
# Root package (ggen) declares these as optional in [dependencies]
ggen-ai = { path = "crates/ggen-ai", version = "0.2.0" }
ggen-dspy = { path = "crates/ggen-dspy", version = "0.2.0" }

# Optional: Marketplace
ggen-marketplace = { path = "crates/ggen-marketplace", version = "0.2.0" }

# Optional: Testing & Quality
ggen-test-audit = { path = "crates/ggen-test-audit", version = "0.2.0" }
ggen-test-opt = { path = "crates/ggen-test-opt", version = "0.2.0" }
ggen-e2e = { path = "crates/ggen-e2e", version = "0.2.0" }

# Optional: Node.js bindings
ggen-node = { path = "crates/ggen-node", version = "0.2.0" }

# Optional: RevOps/Monetization
ggen-api = { path = "crates/ggen-api", version = "0.2.0" }
ggen-auth = { path = "crates/ggen-auth", version = "0.2.0" }
ggen-payments = { path = "crates/ggen-payments", version = "0.2.0" }
ggen-saas = { path = "crates/ggen-saas", version = "0.2.0" }

# Optional: Folk strategy
ggen-folk-strategy = { path = "crates/ggen-folk-strategy", version = "0.2.0" }

# Optional: KNHK Systems (ETL + KGC-4D + Workflow Engine Integration)
knhk-etl = { path = "crates/knhk-etl", version = "0.1.0" }
knhk-hot = { path = "crates/knhk-hot", version = "1.0.0" }
knhk-connectors = { path = "crates/knhk-connectors", version = "0.1.0" }
knhk-lockchain = { path = "crates/knhk-lockchain", version = "0.1.0" }
knhk-otel = { path = "crates/knhk-otel", version = "0.1.0" }
knhk-orchestrator = { path = "crates/knhk-orchestrator", version = "0.1.0" }

# Optional: TPS/TAI Systems
tps-reference = { path = "crates/tps-reference", version = "0.1.0" }
ggen-tps-andon = { path = "crates/ggen-tps-andon", version = "0.1.0" }
tai-testing = { path = "crates/tai-testing", version = "0.1.0" }
tai-k8s = { path = "crates/tai-k8s", version = "0.1.0" }
tai-validation = { path = "crates/tai-validation", version = "0.1.0" }

# OpenTelemetry dependencies (make optional at crate level, not workspace level)
opentelemetry = { version = "0.21" }
opentelemetry-otlp = { version = "0.14" }
opentelemetry_sdk = { version = "0.21", features = ["rt-tokio"] }
tracing-opentelemetry = { version = "0.22" }

# CLI Enhancement libraries
indicatif = "0.18"
console = "0.16"

# Testing libraries
proptest = "1.8"
chicago-tdd-tools = "1.4.0"
fake = "2.9"

# AI integration
genai = "0.5"

# Force base64 version to resolve duplicate dependency issue
# config -> ron -> base64 0.21.7 conflicts with reqwest -> base64 0.22.1
base64 = "0.22"
ron = "0.8"                     # Latest ron (avoids old base64 v0.21.7)

# ===================================================================
# DEPENDENCY DEDUPLICATION (Phase 1 - Critical)
# Added 2026-01-24 to fix 160 duplicate versions
# Target: Reduce build time from >600s to <400s (33% improvement)
# Reference: examples/factory-paas/DEPENDENCY_DEDUPLICATION_PLAN.md
# ===================================================================

# Web frameworks (Critical - highest transitive impact)
# axum: 3 versions → 1 (reduces ~50-80 transitive dependencies)
# tonic: 2 versions → 1 (reduces ~30-50 transitive dependencies)
axum = "0.8"
axum-core = "0.5"
tonic = "0.14"

# Proc-macros (High impact - compilation time reduction)
# derive_more: 3 versions → 1 (v0.99, v1.0, v2.1 consolidated)
# darling ecosystem: 2 versions → 1 (v0.20, v0.21 consolidated)
derive_more = "1.0"
darling = "0.21"
darling_core = "0.21"
darling_macro = "0.21"

# Utilities (Moderate impact - direct dependencies)
# dashmap: 2 versions → 1 (v5.5, v6.1 consolidated)
# bitflags: 3 versions → 1 (consolidated)
# config: 2 versions → 1 (consolidated, default-features=false to allow customization)
# convert_case: 2 versions → 1 (consolidated)
dashmap = "6.1"
bitflags = "2.10"
config = { version = "0.15", default-features = false, features = ["toml"] }  # Explicit toml feature per CARGO_OPTIMIZATION_PLAN
convert_case = "0.10"

# Patch removed - was causing conflicts with same source

# Maximized linting configuration (Rust 1.78+)
# **Poka-Yoke Design**: Warnings are treated as errors to prevent defects at compile time.
# Type-first thinking: Compiler enforces correctness. If it compiles, invariants are enforced.
# Prevention is better than detection - catch issues at compile time, not runtime.
# Note: Individual lint configuration is done via attributes in code
# This section sets global lint levels
[workspace.lints.rust]
warnings = "deny"  # Poka-Yoke: Prevent warnings at compile time
unsafe_code = "deny"
missing_docs = "warn"  # Documentation warnings are less critical than code quality

[workspace.lints.clippy]
# **Poka-Yoke Design**: Deny warnings to prevent defects at compile time.
# Type-first thinking: Use compiler as design tool to enforce correctness.
# Prevention is better than detection - catch issues at compile time, not runtime.
# Set lint groups to deny level for poka-yoke error prevention
all = { level = "deny", priority = -1 }
pedantic = { level = "deny", priority = -1 }
nursery = { level = "deny", priority = -1 }
cargo = { level = "deny", priority = -1 }

# Deny critical lints for Poka-Yoke (error prevention)
# These have higher priority (0) and will override the groups
unwrap_used = "deny"
expect_used = "deny"
panic = "deny"
todo = "deny"
unimplemented = "deny"

# Build optimization lints (added per CARGO_OPTIMIZATION_PLAN)
unused_crate_dependencies = "warn"  # Flag unused dependencies for removal
large_stack_frames = "warn"         # Catch stack overflow risks
type_complexity = "allow"           # Allow complex types (project uses many)

# Allow multiple crate versions due to complex dependency tree
multiple_crate_versions = "allow"

# ===================================================================
# PROC-MACRO DEDUPLICATION STRATEGY (Updated 2026-01-25)
# ===================================================================
# **Status**: Accepted unavoidable duplicates from upstream dependencies
#
# Procedure Macro Consolidation Analysis:
#
# derive_more duplicates (3 versions):
#   - v2.1.1: genai (production) - unavoidable, genai → value-ext forces this
#   - v1.0.0: value-ext ← genai (production, transitive) - unavoidable
#   - v0.99.20: cucumber (dev-only) - ACCEPTABLE
#
# darling duplicates (2 versions):
#   - v0.21.3: serde_with_macros ← genai (production, transitive)
#   - v0.20.11: fake ← chicago-tdd-tools (dev-only) - ACCEPTABLE
#
# **Action**: Maintain v1.0 for derive_more and v0.21 for darling in workspace.
#            Unavoidable conflicts from genai are documented as acceptable.
#
# **Impact**: 2 production proc-macro recompilations (negligible impact)
#            Dev-only duplicates have zero production impact
#
# **Future**: Monitor genai updates for upstream consolidation opportunities
# ===================================================================

[features]
# Core feature flags for faster builds (80/20 optimization)
# Root package only controls its own dependencies (ggen-ai, genai)
# Member crates remain optional in Cargo.toml; use with workspace.members

default = ["core"]

# Feature groups (root package dependencies only)
core = []                    # Minimal: RDF/code-gen only (FAST - 2-3 minutes)

# Optional: AI orchestration (enables ggen-ai and genai dependencies)
ai = ["ggen-ai", "genai"]

# Optional: OpenTelemetry instrumentation (adds ~200 dependencies to ggen-core)
otel = ["ggen-core/otel"]

# Convenience bundles
# Production: Minimal dependencies (fastest builds/smallest binary)
prod = ["core"]

# Development: Essential + AI for local development
dev = ["core", "ai"]

# Full: Everything (maximum functionality, includes otel)
full = ["core", "ai", "otel"]

# Backward compatibility (for environment-specific logging)
nightly = ["ggen-utils/nightly"]
termlog = ["ggen-utils/termlog"]
journald = ["ggen-utils/journald"]
syslog = ["ggen-utils/syslog"]
london_tdd = []

[dependencies]
# Core dependencies (always compiled)
ggen-utils = { path = "crates/ggen-utils", version = "0.2.0" }
ggen-cli-lib = { path = "crates/ggen-cli", version = "0.2.0" }
ggen-core = { path = "crates/ggen-core", version = "0.2.0" }
human-panic = "2.0.3"
better-panic = "0.3.0"
log = "0.4.28"
env_logger = "0.11"
anyhow = "1.0"
serde = { version = "1.0", features = ["derive"] }
uuid = { version = "1.18", features = ["v4"] }
tracing-subscriber = "0.3"

# Minimal async runtime (reduced from "full" features)
tokio = { version = "1.47", features = ["macros", "rt-multi-thread", "io-util", "io-std", "sync", "signal", "time"] }

# CLI/JSON configuration
clap = { version = "4.5", features = ["derive"] }
serde_json = "1.0"
serde_yaml = "0.9"

# Templating
tera = "1.20"

# Time handling
chrono = { version = "0.4", features = ["serde"] }

# Async support
async-trait = "0.1"

# Optional: AI integration (feature-gated, reduces default dependencies)
ggen-ai = { path = "crates/ggen-ai", version = "0.2.0", optional = true }
ggen-dspy = { path = "crates/ggen-dspy", version = "0.2.0", optional = true }
genai = { workspace = true, optional = true }

# Temp file support (small, used by core)
tempfile = "3.23"

# Note: OpenTelemetry dependencies are optional at the crate level (ggen-core, etc.)
# Enable OTEL via: cargo build --features otel (which forwards to ggen-core/otel)

# Example definitions removed - examples now discovered automatically by Cargo

[dev-dependencies]
assert_cmd = "2.0.17"
predicates = "3.1.3"
serde_json = "1.0"
tempfile = "3.23"
anyhow = "1.0"
chrono = { version = "0.4", features = ["serde"] }
ggen-domain = { path = "crates/ggen-domain" }
oxigraph = "0.5.1"
# BDD testing framework
cucumber = { version = "0.21", features = ["macros"] }
assert_fs = "1.1"
mockito = "1.7"
insta = "1.43"
serial_test = "3.2"
md5 = "0.8"
shell-words = "1.1"
# E2E test dependencies
toml = "0.9"
reqwest = { version = "0.12", features = ["blocking", "json"] }
genai = { workspace = true }
proptest.workspace = true
# chicago-tdd-tools = { workspace = true, features = ["testcontainers"] }
# Note: chicago-tdd-tools commented for cross-platform compatibility
# Cleanroom integration for CLI testing
clnrm = "0.1.0"
testcontainers = "0.25"
testcontainers-modules = "0.13"
rand = "0.8"
mockall = "0.13"
fake = "2.9"
futures.workspace = true
tracing.workspace = true
tracing-subscriber.workspace = true
chicago-tdd-tools = { version = "1.4.0", features = ["testing-extras", "testcontainers"] }
# Performance benchmarking
criterion = { version = "0.7", features = ["html_reports"] }
once_cell = "1.20"
lazy_static = "1.4"
fastrand = "2.3"

# Process Mining for workflow analytics
process_mining = "0.2"

[profile.dev]
opt-level = 0
debug = true
rpath = false
lto = false
debug-assertions = true
codegen-units = 256          # More parallel compilation units = faster builds
incremental = true           # Enable incremental compilation
split-debuginfo = "unpacked" # Faster debug builds on macOS

[profile.release]
opt-level = 3
debug = false
rpath = false
lto = "thin"             # Thin LTO for faster builds, still optimized
debug-assertions = false
codegen-units = 4        # Reduced from 16 for better optimization (per CARGO_OPTIMIZATION_PLAN)
strip = true             # Strip symbols for smaller binaries
split-debuginfo = "packed"  # Packed debuginfo (smaller shipping size)
panic = "abort"          # Abort on panic (smaller binary, per SLO)

[profile.test]
opt-level = 0           # Faster test compilation
debug = true
rpath = false
lto = false
debug-assertions = true
codegen-units = 256     # More parallel compilation
incremental = true      # Enable incremental for tests
strip = false           # Keep symbols for test debugging
split-debuginfo = "packed"  # Smaller test binaries per CARGO_OPTIMIZATION_PLAN

[profile.bench]
opt-level = 3
debug = false
rpath = false
lto = true
debug-assertions = false
codegen-units = 1
split-debuginfo = "packed"  # Consistency with release profile
panic = "abort"             # Abort on panic (consistency with release)

[[bench]]
name = "runtime_overhead"
harness = false

[[bench]]
name = "async_runtime_benchmarks"
harness = false

[[bench]]
name = "memory_profiling"
harness = false

[[bench]]
name = "quick_runtime_validation"
harness = false

[[bench]]
name = "conventions_performance"
harness = false

[[bench]]
name = "marketplace_performance"
harness = false

[[bench]]
name = "pipeline_performance"
harness = false

[[bench]]
name = "cli_startup_performance"
harness = false

# Build time benchmarks (v1.0)
[[bench]]
name = "build_time_benchmarks"
harness = false

# Memory usage benchmarks (v1.0)
[[bench]]
name = "memory_usage_benchmarks"
harness = false

# Binary size analysis (v1.0)
[[bench]]
name = "binary_size_analysis"
harness = false

# SLO tracking dashboard (v1.0)
[[bench]]
name = "slo_tracking"
harness = false

[[test]]
name = "testcontainer_marketplace_git_hooks"
path = "tests/integration/testcontainer_marketplace_git_hooks.rs"
required-features = []

[[test]]
name = "full_cycle_container_validation"
path = "tests/integration/full_cycle_container_validation.rs"
required-features = []

[[test]]
name = "nextjs_ontology_sync"
path = "tests/integration/nextjs_ontology_sync.rs"
required-features = []

[[test]]
name = "marketplace_nextjs_ontology_e2e"
path = "tests/integration/marketplace_nextjs_ontology_e2e.rs"
required-features = []

[[test]]
name = "marketplace_package_e2e"
path = "tests/integration/marketplace_package_e2e.rs"
required-features = []

[[test]]
name = "lifecycle_tests"
path = "tests/integration/lifecycle_tests.rs"
required-features = []

[[test]]
name = "code_generation_tests"
path = "tests/integration/code_generation_tests.rs"
required-features = []

[[test]]
name = "cache_tests"
path = "tests/integration/cache_tests.rs"
required-features = []

[[test]]
name = "package_scoring_tests"
path = "tests/integration/package_scoring_tests.rs"
required-features = []

[[test]]
name = "lifecycle_simple_tests"
path = "tests/integration/lifecycle_simple_tests.rs"
required-features = []

[[test]]
name = "config_integration_test"
path = "tests/integration/config/config_integration_test.rs"
required-features = []

[[test]]
name = "config_performance_tests"
path = "tests/integration/config/performance_tests.rs"
required-features = []

[[test]]
name = "gemba_walk_verification"
path = "tests/integration/gemba_walk_verification.rs"
required-features = []

[[test]]
name = "fmea_risk_assessment"
path = "tests/integration/fmea_risk_assessment.rs"
required-features = []

[[test]]
name = "poka_yoke_patterns"
path = "tests/integration/poka_yoke_patterns.rs"
required-features = []

[[test]]
name = "ontology_workflows_hipaa"
path = "tests/integration/ontology_workflows_hipaa.rs"
required-features = []

[[test]]
name = "ontology_workflows_multi_cloud"
path = "tests/integration/ontology_workflows_multi_cloud.rs"
required-features = []

[[test]]
name = "ontology_workflows_guard_evaluation"
path = "tests/integration/ontology_workflows_guard_evaluation.rs"
required-features = []

[[test]]
name = "ontology_workflows_receipts"
path = "tests/integration/ontology_workflows_receipts.rs"
required-features = []

[[test]]
name = "ontology_workflows_e2e"
path = "tests/integration/ontology_workflows_e2e.rs"
required-features = []

# Security integration tests
[[test]]
name = "security_tests"
path = "tests/security/mod.rs"
required-features = []

# TPS Integration Tests
[[test]]
name = "tps_end_to_end_workflow"
path = "tests/tps/end_to_end_workflow_tests.rs"
required-features = []

[[test]]
name = "tps_smoke_tests"
path = "tests/tps/smoke_tests.rs"
required-features = []

[[test]]
name = "tps_regression_tests"
path = "tests/tps/regression_tests.rs"
required-features = []

[[test]]
name = "tps_performance_regression"
path = "tests/tps/performance_regression_tests.rs"
required-features = []

[[test]]
name = "tps_chaos_tests"
path = "tests/tps/chaos_tests.rs"
required-features = []

[[test]]
name = "tps_test_data_generation"
path = "tests/tps/test_data_generation.rs"
required-features = []

[[test]]
name = "build_optimization_profiles"
path = "tests/build_optimization/profiles.rs"
required-features = []

[[test]]
name = "build_optimization_feature_flags"
path = "tests/build_optimization/feature_flags.rs"
required-features = []

[[test]]
name = "build_optimization_dependencies"
path = "tests/build_optimization/dependencies.rs"
required-features = []

[[test]]
name = "build_optimization_performance"
path = "tests/build_optimization/performance.rs"
required-features = []

[[test]]
name = "build_optimization_binary_compat"
path = "tests/build_optimization/binary_compat.rs"
required-features = []
