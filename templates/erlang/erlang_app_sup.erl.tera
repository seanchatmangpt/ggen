{% set app_name = app_name | default(value="myapp") -%}
{% set description = description | default(value="OTP Application Supervisor") -%}
{% set author = author | default(value="Generated by ggen") -%}
{% set restart_strategy = restart_strategy | default(value="one_for_one") -%}
{% set max_restarts = max_restarts | default(value=5) -%}
{% set max_seconds = max_seconds | default(value=10) -%}
%%%-------------------------------------------------------------------
%%% @author {{ author }}
%%% @copyright (C) {% raw %}{{{% endraw %} current_year {% raw %}}}{% endraw %}, {{ author }}
%%% @doc
%%% {{ description }}
%%%
%%% Top-level supervisor for {{ app_name }} application.
%%% Implements OTP supervisor behavior with {{ restart_strategy }} strategy.
%%%
%%% Restart Strategy: {{ restart_strategy }}
%%% Max Restarts: {{ max_restarts }} in {{ max_seconds }} seconds
%%%
%%% SPARQL Integration:
%%% This template supports querying RDF ontologies for:
%%% - Supervisor configuration (restart strategy, intensity, period)
%%% - Child specification definitions
%%% - Supervision tree structure
%%%
%%% @end
%%% Created : {% raw %}{{{% endraw %} timestamp {% raw %}}}{% endraw %}
%%%-------------------------------------------------------------------
-module({{ app_name }}_sup).

-behaviour(supervisor).

%% API
-export([start_link/0]).

%% Supervisor callbacks
-export([init/1]).

-define(SERVER, ?MODULE).

%%%===================================================================
%%% API functions
%%%===================================================================

%%--------------------------------------------------------------------
%% @doc
%% Starts the supervisor
%%
%% @end
%%--------------------------------------------------------------------
-spec start_link() -> {ok, Pid :: pid()} |
                     {error, {already_started, Pid :: pid()}} |
                     {error, {shutdown, term()}} |
                     {error, term()} |
                     ignore.
start_link() ->
    supervisor:start_link({local, ?SERVER}, ?MODULE, []).

%%%===================================================================
%%% Supervisor callbacks
%%%===================================================================

%%--------------------------------------------------------------------
%% @private
%% @doc
%% Whenever a supervisor is started using supervisor:start_link/[2,3],
%% this function is called by the new process to find out about
%% restart strategy, maximum restart intensity, and child
%% specifications.
%%
%% @end
%%--------------------------------------------------------------------
-spec init(Args :: term()) ->
    {ok, {SupFlags :: supervisor:sup_flags(),
          [ChildSpec :: supervisor:child_spec()]}} |
    ignore.
init([]) ->
    SupFlags = #{
        strategy => {{ restart_strategy }},
        intensity => {{ max_restarts }},
        period => {{ max_seconds }}
    },

    %% Child specifications
    ChildSpecs = [
        {% if children %}
        {% for child in children %}
        #{
            id => {{ child.id }},
            start => { {{child.module}}, {{child.function}}, {{child.args | default(value="[]")}} },
            restart => {{ child.restart | default(value="permanent") }},
            shutdown => {{ child.shutdown | default(value="5000") }},
            type => {{ child.type | default(value="worker") }},
            modules => [{{ child.module }}]
        }{% if not loop.last %},{% endif %}
        {% endfor %}
        {% else %}
        %% Example child specification:
        %% #{
        %%     id => worker_id,
        %%     start => {worker_module, start_link, []},
        %%     restart => permanent,
        %%     shutdown => 5000,
        %%     type => worker,
        %%     modules => [worker_module]
        %% }
        {% endif %}
    ],

    {ok, {SupFlags, ChildSpecs}}.

%%%===================================================================
%%% Internal functions
%%%===================================================================

%%%===================================================================
%%% Unit Tests
%%%===================================================================

-ifdef(TEST).
-include_lib("eunit/include/eunit.hrl").

start_link_test() ->
    %% Test supervisor startup
    case start_link() of
        {ok, Pid} ->
            ?assert(is_pid(Pid)),
            ?assert(is_process_alive(Pid)),
            supervisor:terminate_child(?SERVER, Pid),
            ok;
        {error, {already_started, _Pid}} ->
            %% Supervisor already running from previous test
            ok
    end.

init_test() ->
    {ok, {SupFlags, _ChildSpecs}} = init([]),
    ?assertEqual({{ restart_strategy }}, maps:get(strategy, SupFlags)),
    ?assertEqual({{ max_restarts }}, maps:get(intensity, SupFlags)),
    ?assertEqual({{ max_seconds }}, maps:get(period, SupFlags)).

-endif.
