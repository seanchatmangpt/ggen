# =============================================================================
# MCP+ Board Report Generation - Main Configuration
#
# Core axiom: A = μ(O), μ ∘ μ = μ, hash(A) = hash(μ(O)), O ⊨ Σ
#
# Generated by ggen - DO NOT EDIT MANUALLY
# Regenerate with: ggen sync --audit true
# =============================================================================

[system]
name = "mcp-board-report"
version = "1.0.0"
environment = "{{ environment | default(value='production') }}"

# Core axioms (immutable)
[system.axioms]
core = "A = μ(O)"
idempotent = "μ ∘ μ = μ"
deterministic = "hash(A) = hash(μ(O))"
valid = "O ⊨ Σ"

# -----------------------------------------------------------------------------
# Envelope Defaults
# -----------------------------------------------------------------------------

[envelope.defaults]
# Maximum execution time in milliseconds
time_bound_ms = 30000

# Maximum memory usage in bytes (100MB)
resource_bound_bytes = 104857600

# Maximum CPU time in milliseconds
cpu_bound_ms = 10000

# Maximum I/O operations
io_bound_ops = 1000

# -----------------------------------------------------------------------------
# Receipt Configuration
# -----------------------------------------------------------------------------

[receipts]
enabled = true
storage_path = "/var/lib/mcp/receipts"
chain_enabled = true
hash_algorithm = "sha256"

# Retention policy
[receipts.retention]
days = 365
archive_after_days = 90
compress_archives = true

# -----------------------------------------------------------------------------
# Evidence Bundle Configuration
# -----------------------------------------------------------------------------

[evidence]
bundle_path = "/var/lib/mcp/bundles"
bundle_version = "1.0.0"
file_extension = ".mcpb"

# Bundle generation schedule
[evidence.schedule]
daily_bundle = true
daily_bundle_hour = 2  # 2 AM UTC
weekly_bundle = true
weekly_bundle_day = 0  # Sunday
quarterly_bundle = true

# -----------------------------------------------------------------------------
# Kill Switch Configuration
# -----------------------------------------------------------------------------

[kill_switch]
enabled = true

# Fail-closed behavior
fail_closed = true
uncertainty_action = "refuse"

# Drill requirements
[kill_switch.drills]
quarterly_required = true
types = ["global", "family", "capability", "epoch"]

# -----------------------------------------------------------------------------
# Key Management
# -----------------------------------------------------------------------------

[keys]
# HSM integration (production)
hsm_enabled = {{ hsm_enabled | default(value="false") }}
hsm_provider = "{{ hsm_provider | default(value='softhsm') }}"

# Key epoch settings
[keys.epoch]
rotation_days = 90
warning_days = 14
auto_rotate = false

# Key storage
[keys.storage]
path = "/var/lib/mcp/keys"
backup_path = "/var/lib/mcp/keys/backup"
encryption = "aes-256-gcm"

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------

[logging]
level = "info"
format = "json"
output = "/var/log/mcp/mcp.log"

# Log rotation
[logging.rotation]
max_size_mb = 100
max_files = 10
compress = true

# Audit logging (separate from operational logs)
[logging.audit]
enabled = true
path = "/var/log/mcp/audit.log"
include_receipts = true

# -----------------------------------------------------------------------------
# Metrics Configuration
# -----------------------------------------------------------------------------

[metrics]
enabled = true
endpoint = "0.0.0.0:9090"
path = "/metrics"

# Metric types to collect
[metrics.collect]
operations = true
refusals = true
latencies = true
envelope_usage = true
receipt_chain = true

# -----------------------------------------------------------------------------
# Erlang Runtime Configuration
# -----------------------------------------------------------------------------

[erlang]
node_name = "mcp@localhost"
cookie = "{{ erlang_cookie | default(value='mcp_secret_cookie') }}"
distributed = {{ distributed | default(value="false") }}

# Scheduler settings
[erlang.schedulers]
online = {{ schedulers_online | default(value="auto") }}
dirty_cpu = {{ dirty_cpu_schedulers | default(value="auto") }}
dirty_io = {{ dirty_io_schedulers | default(value=10) }}

# Memory settings
[erlang.memory]
max_heap_size = "1G"
process_limit = 262144
port_limit = 65536

# -----------------------------------------------------------------------------
# Rust NIF Configuration
# -----------------------------------------------------------------------------

[nif]
library_path = "priv/mcp_nif"
dirty_scheduler = true
panic_catch = true

# Performance tuning
[nif.performance]
thread_pool_size = {{ nif_thread_pool | default(value=4) }}
async_threshold_bytes = 4096

# -----------------------------------------------------------------------------
# Network Configuration
# -----------------------------------------------------------------------------

[network]
# Internal API
[network.internal]
bind = "0.0.0.0"
port = 8080
tls_enabled = true
tls_cert = "/etc/mcp/certs/server.crt"
tls_key = "/etc/mcp/certs/server.key"

# Health check endpoint
[network.health]
enabled = true
path = "/health"
port = 8081

# -----------------------------------------------------------------------------
# Multi-Region Configuration
# -----------------------------------------------------------------------------

[regions]
primary = "{{ primary_region | default(value='us-east-1') }}"
failover = ["{{ failover_regions | default(value='eu-west-1, ap-northeast-1') | split(pat=', ') | join(sep='", "') }}"]

# Region sync settings
[regions.sync]
interval_ms = 1000
receipt_replication = true
consensus_required = 2

# -----------------------------------------------------------------------------
# Workflow Tier Classification
# -----------------------------------------------------------------------------

[workflow_tiers]

[workflow_tiers.tier_a]
name = "Automate"
description = "High-confidence automation"
examples = ["onboarding", "reconciliations", "claims_triage", "vendor_validation"]
requires_human_review = false

[workflow_tiers.tier_b]
name = "Assist"
description = "Human-supervised operations"
examples = ["customer_disputes", "complex_adjudication", "novel_fraud"]
requires_human_review = true

[workflow_tiers.tier_c]
name = "Do Not Automate"
description = "Hard boundary - no automation"
examples = ["employment_decisions", "legal_judgment", "safety_critical_physical"]
automation_blocked = true

# -----------------------------------------------------------------------------
# Accountability RACI
# -----------------------------------------------------------------------------

[accountability]

[accountability.business_owner]
owns = ["outcomes", "scope"]
contact = "{{ business_owner_email | default(value='business@example.com') }}"

[accountability.contract_authority]
owns = ["sealed_contract_changes"]
contact = "{{ contract_authority_email | default(value='contracts@example.com') }}"

[accountability.risk_and_audit]
owns = ["verification_artifacts"]
contact = "{{ risk_audit_email | default(value='audit@example.com') }}"

[accountability.operations]
owns = ["incident_response", "dr"]
contact = "{{ operations_email | default(value='ops@example.com') }}"

[accountability.ciso]
owns = ["key_policy", "supply_chain_integrity"]
contact = "{{ ciso_email | default(value='security@example.com') }}"
