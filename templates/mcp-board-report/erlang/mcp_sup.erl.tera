%%%-----------------------------------------------------------------------------
%%% @doc MCP+ Top-Level Supervisor
%%%
%%% OTP supervisor for the MCP+ Board Report Generation System.
%%% Manages contract execution, envelope enforcement, receipt generation,
%%% and kill-switch components.
%%%
%%% Supervision Strategy: one_for_one
%%% Max Restarts: {{ max_restarts | default(value=5) }}
%%% Max Seconds: {{ max_seconds | default(value=10) }}
%%%
%%% Generated by ggen - DO NOT EDIT MANUALLY
%%% Regenerate with: ggen sync --audit true
%%% @end
%%%-----------------------------------------------------------------------------
-module(mcp_sup).

-behaviour(supervisor).

%% API
-export([start_link/0]).

%% Supervisor callbacks
-export([init/1]).

-define(SERVER, ?MODULE).
-define(MAX_RESTARTS, {{ max_restarts | default(value=5) }}).
-define(MAX_SECONDS, {{ max_seconds | default(value=10) }}).

%%%=============================================================================
%%% API Functions
%%%=============================================================================

%% @doc Start the supervisor
-spec start_link() -> {ok, Pid} | ignore | {error, Reason} when
    Pid :: pid(),
    Reason :: term().
start_link() ->
    supervisor:start_link({local, ?SERVER}, ?MODULE, []).

%%%=============================================================================
%%% Supervisor Callbacks
%%%=============================================================================

%% @doc Initialize the supervisor with child specifications
-spec init(Args) -> {ok, {SupFlags, ChildSpecs}} | ignore when
    Args :: term(),
    SupFlags :: supervisor:sup_flags(),
    ChildSpecs :: [supervisor:child_spec()].
init([]) ->
    SupFlags = #{
        strategy => one_for_one,
        intensity => ?MAX_RESTARTS,
        period => ?MAX_SECONDS
    },

    %% Kill switch MUST start first - provides emergency control
    KillSwitchSpec = #{
        id => mcp_kill_switch,
        start => {mcp_kill_switch, start_link, []},
        restart => permanent,
        shutdown => 5000,
        type => worker,
        modules => [mcp_kill_switch]
    },

    %% Receipt server - generates cryptographic receipts
    ReceiptServerSpec = #{
        id => mcp_receipt_server,
        start => {mcp_receipt_server, start_link, []},
        restart => permanent,
        shutdown => 5000,
        type => worker,
        modules => [mcp_receipt_server]
    },

    %% Envelope server - enforces operational bounds
    EnvelopeServerSpec = #{
        id => mcp_envelope_server,
        start => {mcp_envelope_server, start_link, []},
        restart => permanent,
        shutdown => 5000,
        type => worker,
        modules => [mcp_envelope_server]
    },

    %% Contract server - executes sealed contracts
    ContractServerSpec = #{
        id => mcp_contract_server,
        start => {mcp_contract_server, start_link, []},
        restart => permanent,
        shutdown => 5000,
        type => worker,
        modules => [mcp_contract_server]
    },

    %% Evidence server - generates .mcpb bundles
    EvidenceServerSpec = #{
        id => mcp_evidence_server,
        start => {mcp_evidence_server, start_link, []},
        restart => permanent,
        shutdown => 5000,
        type => worker,
        modules => [mcp_evidence_server]
    },

    ChildSpecs = [
        KillSwitchSpec,
        ReceiptServerSpec,
        EnvelopeServerSpec,
        ContractServerSpec,
        EvidenceServerSpec
    ],

    logger:info("MCP+ Supervisor initialized", #{
        strategy => one_for_one,
        children => length(ChildSpecs),
        max_restarts => ?MAX_RESTARTS,
        max_seconds => ?MAX_SECONDS
    }),

    {ok, {SupFlags, ChildSpecs}}.

%%%=============================================================================
%%% Internal Functions
%%%=============================================================================

%% Reserved for future internal functions
