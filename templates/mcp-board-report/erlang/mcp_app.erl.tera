%%%-----------------------------------------------------------------------------
%%% @doc MCP+ Application Module
%%%
%%% OTP application behavior for the MCP+ Board Report Generation System.
%%% Implements sealed operating contracts with cryptographic verification.
%%%
%%% Core axiom: A = μ(O), μ ∘ μ = μ, hash(A) = hash(μ(O)), O ⊨ Σ
%%%
%%% Generated by ggen - DO NOT EDIT MANUALLY
%%% Regenerate with: ggen sync --audit true
%%% @end
%%%-----------------------------------------------------------------------------
-module(mcp_app).

-behaviour(application).

%% Application callbacks
-export([start/2, stop/1]).

%% API
-export([
    version/0,
    axiom_set/0
]).

-define(VERSION, <<"1.0.0">>).

%%%=============================================================================
%%% Application callbacks
%%%=============================================================================

%% @doc Start the MCP+ application
-spec start(StartType, StartArgs) -> {ok, Pid} | {error, Reason} when
    StartType :: application:start_type(),
    StartArgs :: term(),
    Pid :: pid(),
    Reason :: term().
start(_StartType, _StartArgs) ->
    logger:info("MCP+ Application starting", #{
        version => ?VERSION,
        axiom => <<"A = μ(O)">>
    }),

    %% Load NIF library for cryptographic operations
    case mcp_nif:load() of
        ok ->
            logger:info("MCP+ NIF library loaded successfully"),
            ok;
        {error, NifError} ->
            logger:error("Failed to load MCP+ NIF library: ~p", [NifError]),
            {error, {nif_load_failed, NifError}}
    end,

    %% Start the supervision tree
    case mcp_sup:start_link() of
        {ok, Pid} ->
            logger:info("MCP+ Application started", #{
                supervisor => Pid,
                kill_switch => enabled
            }),
            {ok, Pid};
        {error, Reason} ->
            logger:error("Failed to start MCP+ supervisor: ~p", [Reason]),
            {error, Reason}
    end.

%% @doc Stop the MCP+ application
-spec stop(State) -> ok when
    State :: term().
stop(_State) ->
    logger:info("MCP+ Application stopping", #{
        version => ?VERSION
    }),
    ok.

%%%=============================================================================
%%% API Functions
%%%=============================================================================

%% @doc Return the application version
-spec version() -> binary().
version() ->
    ?VERSION.

%% @doc Return the core axiom set
-spec axiom_set() -> map().
axiom_set() ->
    #{
        core => <<"A = μ(O)">>,
        idempotent => <<"μ ∘ μ = μ">>,
        deterministic => <<"hash(A) = hash(μ(O))">>,
        valid => <<"O ⊨ Σ">>
    }.

%%%=============================================================================
%%% Internal Functions
%%%=============================================================================

%% Reserved for future internal functions
