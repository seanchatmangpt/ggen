---
to: "src/middleware/pattern_{{ index }}.rs"
vars:
  index: 3
  middleware: "middleware_pattern_3"
---

use std::future::Future;
use std::pin::Pin;

pub type Middleware3Fn = Box<
    dyn Fn(String) -> Pin<Box<dyn Future<Output = Result<String, String>> + Send>> + Send + Sync,
>;

/// Middleware pattern 3 for request/response handling
pub struct MiddlewarePattern3 {
    handler: Middleware3Fn,
}

impl MiddlewarePattern3 {
    pub fn new<F>(handler: F) -> Self
    where
        F: Fn(String) -> Pin<Box<dyn Future<Output = Result<String, String>> + Send>> + Send + Sync + 'static,
    {
        Self {
            handler: Box::new(handler),
        }
    }

    pub async fn handle(&self, input: String) -> Result<String, String> {
        (self.handler)(input).await
    }
}
