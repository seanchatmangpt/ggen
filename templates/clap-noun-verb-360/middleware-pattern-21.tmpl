---
to: "src/middleware/pattern_{{ index }}.rs"
vars:
  index: 21
  middleware: "middleware_pattern_21"
---

use std::future::Future;
use std::pin::Pin;

pub type Middleware21Fn = Box<
    dyn Fn(String) -> Pin<Box<dyn Future<Output = Result<String, String>> + Send>> + Send + Sync,
>;

/// Middleware pattern 21 for request/response handling
pub struct MiddlewarePattern21 {
    handler: Middleware21Fn,
}

impl MiddlewarePattern21 {
    pub fn new<F>(handler: F) -> Self
    where
        F: Fn(String) -> Pin<Box<dyn Future<Output = Result<String, String>> + Send>> + Send + Sync + 'static,
    {
        Self {
            handler: Box::new(handler),
        }
    }

    pub async fn handle(&self, input: String) -> Result<String, String> {
        (self.handler)(input).await
    }
}
