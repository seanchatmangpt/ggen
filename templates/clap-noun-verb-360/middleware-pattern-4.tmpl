---
to: "src/middleware/pattern_{{ index }}.rs"
vars:
  index: 4
  middleware: "middleware_pattern_4"
---

use std::future::Future;
use std::pin::Pin;

pub type Middleware4Fn = Box<
    dyn Fn(String) -> Pin<Box<dyn Future<Output = Result<String, String>> + Send>> + Send + Sync,
>;

/// Middleware pattern 4 for request/response handling
pub struct MiddlewarePattern4 {
    handler: Middleware4Fn,
}

impl MiddlewarePattern4 {
    pub fn new<F>(handler: F) -> Self
    where
        F: Fn(String) -> Pin<Box<dyn Future<Output = Result<String, String>> + Send>> + Send + Sync + 'static,
    {
        Self {
            handler: Box::new(handler),
        }
    }

    pub async fn handle(&self, input: String) -> Result<String, String> {
        (self.handler)(input).await
    }
}
