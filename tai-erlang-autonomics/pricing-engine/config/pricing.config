%%%-------------------------------------------------------------------
%% Pricing Engine Runtime Configuration
%%%-------------------------------------------------------------------

{pricing_engine, [
    %% Core engine settings
    {environment, production},
    {max_customers, 100000},
    {max_metrics_per_calculation, 100},

    %% Value bounds (prevent extreme values)
    {min_value_per_calculation, 0.0},
    {max_value_per_calculation, 1000000000.0},
    {value_tolerance_percent, 0.1},

    %% Pricing formula defaults
    {default_alpha_coefficient, 100.0},
    {default_min_price, 0.0},
    {default_max_price, 10000.0},
    {default_aggregation_method, weighted_sum},

    %% Stripe integration
    {stripe_enabled, true},
    {stripe_api_version, <<"2023-10-16">>},
    {stripe_max_retries, 3},
    {stripe_retry_delay_ms, 1000},
    {stripe_timeout_ms, 30000},

    %% Database backend
    {db_backend, firestore},
    {firestore_project, <<"tai-autonomics-prod">>},
    {firestore_database, <<"pricing-ledger">>},
    {firestore_timeout_ms, 10000},

    %% Ledger settings
    {ledger_type, immutable},
    {ledger_rotation_days, 90},
    {ledger_archive_destination, <<"gs://tai-pricing-archive">>},

    %% Security settings
    {security_level, strict},
    {customer_isolation, true},
    {validate_all_inputs, true},
    {anomaly_detection_enabled, true},
    {spike_detection_threshold, 5.0},  %% >500% increase flagged
    {audit_trail_enabled, true},
    {audit_retention_days, 2555},  %% 7 years for compliance

    %% Cryptography
    {hash_algorithm, sha256},
    {hmac_algorithm, sha256},
    {signature_algorithm, ed25519},
    {use_constant_time_compare, true},

    %% Monitoring and observability
    {monitoring_enabled, true},
    {prometheus_enabled, true},
    {prometheus_port, 9090},
    {otel_enabled, true},
    {otel_exporter, otlp_http},
    {otel_endpoint, <<"http://localhost:4318">>},
    {structured_logging, true},
    {json_logs, true},

    %% Alerting
    {alerting_enabled, true},
    {slack_enabled, false},
    {pagerduty_enabled, false},
    {alert_critical_anomalies, true},
    {alert_payment_failures, true},
    {alert_high_latency, true},

    %% Rate limiting
    {rate_limiting_enabled, true},
    {rate_limit_requests_per_minute, 1000},
    {rate_limit_per_customer, true},
    {customer_rate_limit_per_minute, 100},

    %% Performance tuning
    {calculation_timeout_ms, 5000},
    {hash_generation_timeout_ms, 1000},
    {merkle_verification_timeout_ms, 2000},
    {stripe_operation_timeout_ms, 30000},

    %% Caching (if enabled)
    {caching_enabled, false},
    {cache_ttl_seconds, 300},
    {max_cache_entries, 10000},

    %% Testing/Debug
    {test_mode, false},
    {debug_logging, false},
    {mock_stripe, false},
    {mock_firestore, false}
]}.

%% Logging configuration
{kernel, [
    {logger_level, info},
    {logger, [
        {handler, default, logger_std_h, #{
            level => info,
            formatter => {logger_formatter, #{
                template => [time, " [", level, "] ", msg, "\n"],
                time_designator => $T,
                time_offset => "Z"
            }}
        }},
        {handler, json, logger_std_h, #{
            level => info,
            formatter => {logger_json_formatter, #{
                template => [
                    {time, [value]},
                    {level, [value]},
                    {msg, [value]},
                    {mfa, [value]},
                    {pid, [value]}
                ]
            }},
            config => #{
                type => file,
                file => "log/pricing.json"
            }
        }}
    ]}
]}.

%% SASL configuration
{sasl, [
    {sasl_error_logger, false}
]}.

%% Inets (HTTP client) configuration
{inets, [
    {services, [{httpc, [{profile, default}]}]}
]}.

%% Crypto configuration
{crypto, [
    {fips, false}
]}.
