# Generated by ggen-craftplan - DO NOT EDIT
defmodule {{ module.name }} do
  @moduledoc """
  Ash Resource for {{ module.entity.local_name }}.

  This module is automatically generated from RDF ontology specifications.
  """

  use Ash.Resource

  # PostgreSQL data layer
  postgres do
    table "{{ module.entity.local_name | lower }}s"
    repo Craftplan.Repo
  end

  # Resource actions
  actions do
    defaults [:create, :read, :update, :destroy]
  end

  # Attributes
  attributes do
    {% for field in module.fields %}
    {{ field.name }} :{{ elixir_type.to_ash_type(field.field_type) }}
    {% if field.primary_key %}
    allow_nil? false
    primary_key? true
    {% else %}
    allow_nil? {% if field.required %}false{% else %}true{% endif %}
    {% endif %}
    {% if field.default %}
    default {{ field.default }}
    {% endif %}
    {% endfor %}
  end

  # Relationships
  relationships do
    {% for rel in module.relationships %}
    {% if rel.cardinality == "one_to_many" %}
    has_many {{ rel.name }} :{{ rel.target_module }} do
      {{ rel.name }} {{ rel.foreign_key }}
    end
    {% elif rel.cardinality == "belongs_to" %}
    belongs_to {{ rel.name }} :{{ rel.target_module }} do
      attribute_type :uuid
      allow_nil? {% if rel.required %}false{% else %}true{% endif %}
    end
    {% endif %}
    {% endfor %}
  end

  # Validations
  validations do
    {% for validation in module.validations %}
    validate { validate_{{ validation.validation_type | snake_case }}({{ validation.field }}) }
    {% endfor %}
  end
end
