@startuml C4_Marketplace_Deployment
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Deployment.puml

LAYOUT_WITH_LEGEND()

title Rgen Marketplace - Deployment Diagram

Person(developer, "Developer", "Uses rgen CLI")
Person(publisher, "Publisher", "Publishes rpacks")

Deployment_Node(developer_machine, "Developer Machine", "Local Development") {
    Container(rgen_cli, "Rgen CLI", "Rust Binary", "Installed via cargo/package manager")
    ContainerDb(local_cache, "Local Cache", "File System", "~/.rgen/rpacks/")
    ContainerDb(project_lockfile, "Project Lockfile", "TOML File", "rgen.lock")
    ContainerDb(project_config, "Project Config", "TOML File", "rgen.toml")
}

Deployment_Node(github_platform, "GitHub Platform", "Cloud Hosting") {
    Deployment_Node(registry_repo, "Registry Repository", "GitHub Repo") {
        Container(registry_index, "Registry Index", "JSON File", "index.json")
        Container(ci_pipeline, "CI/CD Pipeline", "GitHub Actions", "Validation and deployment")
    }
    
    Deployment_Node(rpack_repos, "Rpack Repositories", "GitHub Repos") {
        Container(rpack_manifest, "Rpack Manifest", "TOML File", "templates/rgen.toml")
        Container(rpack_templates, "Templates", "Tera Files", "*.tmpl files")
        Container(rpack_rdf, "RDF Data", "Turtle Files", "Graph data")
        Container(rpack_queries, "SPARQL Queries", "SPARQL Files", "Query files")
    }
    
    Deployment_Node(github_pages, "GitHub Pages", "CDN") {
        Container(registry_pages, "Registry Pages", "Static Site", "registry.rgen.dev")
    }
}

Deployment_Node(network, "Internet", "Network") {
    Container(https, "HTTPS", "TLS", "Secure communication")
    Container(git_protocol, "Git Protocol", "SSH/HTTPS", "Repository access")
}

' Developer Machine Connections
Rel(developer, rgen_cli, "Uses", "CLI commands")
Rel(rgen_cli, local_cache, "Reads/Writes", "File I/O")
Rel(rgen_cli, project_lockfile, "Reads/Writes", "TOML parsing")
Rel(rgen_cli, project_config, "Reads", "Configuration")

' Network Connections
Rel(rgen_cli, https, "HTTPS requests", "Registry API")
Rel(rgen_cli, git_protocol, "Git operations", "Clone rpacks")
Rel(https, registry_pages, "Fetches index", "GET /index.json")
Rel(git_protocol, rpack_repos, "Clones repositories", "Git clone")

' GitHub Platform Connections
Rel(registry_pages, registry_index, "Serves", "Static file serving")
Rel(ci_pipeline, registry_index, "Updates", "Automated deployment")
Rel(ci_pipeline, rpack_repos, "Validates", "Automated checks")
Rel(publisher, rpack_repos, "Publishes", "Git push")
Rel(publisher, registry_repo, "Submits", "PR workflow")

' Deployment Notes
note right of developer_machine
  **Local Installation**
  - Rgen CLI installed via cargo
  - Local cache in ~/.rgen/rpacks/
  - Project files in workspace
end note

note right of github_platform
  **GitHub Infrastructure**
  - Registry repo: rgen-registry
  - Rpack repos: individual GitHub repos
  - GitHub Pages: CDN for registry index
  - GitHub Actions: CI/CD validation
end note

note right of network
  **Security**
  - HTTPS for registry access
  - Git authentication for repos
  - SHA256 verification for integrity
end note

@enduml
