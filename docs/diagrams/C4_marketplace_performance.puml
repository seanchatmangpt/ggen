@startuml C4_Marketplace_Performance
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

LAYOUT_WITH_LEGEND()

title Rgen Marketplace - Performance & Scalability

Person(developer, "Developer", "Uses rgen CLI")

System_Boundary(local_system, "Local System") {
    Component(cli, "CLI", "Rust", "rgen commands")
    Component(cache, "Local Cache", "File System", "~/.rgen/rpacks/")
    Component(lockfile, "Lockfile", "TOML", "rgen.lock")
}

System_Boundary(registry_system, "Registry System") {
    Component(registry_index, "Registry Index", "JSON", "index.json")
    Component(registry_pages, "GitHub Pages", "CDN", "registry.rgen.dev")
    Component(ci_pipeline, "CI/CD Pipeline", "GitHub Actions", "Validation")
}

System_Boundary(rpack_repos, "Rpack Repositories") {
    Component(rpack_manifest, "Rpack Manifest", "TOML", "templates/rgen.toml")
    Component(rpack_templates, "Templates", "Tera", "*.tmpl files")
    Component(rpack_rdf, "RDF Data", "Turtle", "Graph data")
}

System_Boundary(performance_optimizations, "Performance Optimizations") {
    Component(local_caching, "Local Caching", "File System", "~/.rgen/rpacks/")
    Component(index_caching, "Index Caching", "Memory", "Registry index cache")
    Component(parallel_downloads, "Parallel Downloads", "Concurrent", "Multiple rpacks")
    Component(incremental_updates, "Incremental Updates", "Delta", "Only changed files")
    Component(compression, "Compression", "Gzip", "Compressed transfers")
    Component(cdn_distribution, "CDN Distribution", "Global", "Edge caching")
}

' Performance Optimizations
Rel(local_caching, cache, "Optimizes", "Local storage")
Rel(index_caching, registry_index, "Caches", "Registry data")
Rel(parallel_downloads, rpack_repos, "Parallelizes", "Downloads")
Rel(incremental_updates, cache, "Minimizes", "Transfer size")
Rel(compression, registry_pages, "Reduces", "Bandwidth")
Rel(cdn_distribution, registry_pages, "Distributes", "Global access")

' Performance Metrics
note right of local_caching
  **Local Cache Performance**
  - Cache hit rate: >90%
  - Cache size: <100MB typical
  - Cache lookup: <10ms
  - Cache cleanup: Automatic
end note

note right of index_caching
  **Registry Index Performance**
  - Index size: <1MB
  - Index fetch: <500ms
  - Index cache: 1 hour TTL
  - Index updates: Real-time
end note

note right of parallel_downloads
  **Download Performance**
  - Parallel downloads: 3 concurrent
  - Download speed: Limited by network
  - Retry logic: 3 attempts
  - Timeout: 30 seconds
end note

note right of cdn_distribution
  **CDN Performance**
  - Global distribution: 200+ locations
  - Cache hit rate: >95%
  - Response time: <100ms
  - Availability: 99.9%
end note

' Scalability Considerations
note bottom of registry_system
  **Scalability Limits**
  - Registry index: 10,000+ rpacks
  - GitHub Pages: 1GB limit
  - CI pipeline: 100 concurrent jobs
  - Repository size: 100MB per rpack
end note

note bottom of rpack_repos
  **Repository Scalability**
  - GitHub repos: Unlimited
  - Repository size: 100MB limit
  - Clone performance: Git optimization
  - Storage: Distributed across repos
end note

' Performance Monitoring
note right of cli
  **Performance Monitoring**
  - Command execution time
  - Cache hit/miss rates
  - Network transfer speeds
  - Error rates and retries
  - User experience metrics
end note

@enduml
