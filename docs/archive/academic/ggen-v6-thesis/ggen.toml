# ggen v6 PhD Thesis - Meta-Circular Generation Configuration
# This thesis about v6 is generated BY v6 (eating our own dog food)

[project]
name = "ggen-v6-thesis"
version = "6.0.0"
description = "PhD thesis documenting ggen v6 ontology-first software construction"

[v6]
enabled = true
ontology = "ontology/thesis-schema.ttl,ontology/v6-content.ttl"
output_dir = "generated"

# Staged compilation pipeline (μ₁...μ₅)
[v6.passes]
normalization = { order = 1, type = "construct" }
extraction = { order = 2, type = "select" }
emission = { order = 3, type = "tera" }
canonicalization = { order = 4, type = "format" }
receipt = { order = 5, type = "hash" }

# Constitutional invariants - thesis content is substrate, LaTeX is projection
[v6.invariants]
idempotence = true      # Regenerating produces identical output
determinism = true      # Same ontology → same LaTeX
provenance = true       # Receipt proves: LaTeX = μ(RDF)
no_edit = true          # LaTeX files never hand-edited
substrate_only = true   # Only RDF is authored

# Vocabulary governance
[v6.vocabulary]
allowed = [
    "http://www.w3.org/1999/02/22-rdf-syntax-ns#",
    "http://www.w3.org/2000/01/rdf-schema#",
    "http://www.w3.org/2002/07/owl#",
    "http://ggen.dev/v6#",
    "http://ggen.dev/thesis#",  # Thesis structure vocabulary
]

# Guards - protect against common errors
[v6.guards]
path = { pattern = "generated/**/*.tex", action = "allow" }
secret = { pattern = "(?i)(password|secret|api.?key)", action = "reject" }

# Template configuration
[templates]
directory = "templates"

# RDF configuration
[rdf]
base_uri = "http://ggen.dev/thesis/v6#"
default_format = "turtle"
ontologies = [
    "ontology/thesis-schema.ttl",
    "ontology/v6-content.ttl"
]

# Generation rules (μ₂: Extraction Pass)
# SPARQL SELECT queries extract RDF → bindings for Tera templates

[[generation]]
name = "thesis-main"
query = """
PREFIX thesis: <http://ggen.dev/thesis#>
PREFIX dc: <http://purl.org/dc/terms/>

SELECT ?title ?subtitle ?author ?date ?abstract ?keywords
WHERE {
  ?thesis a thesis:Thesis ;
          thesis:title ?title ;
          thesis:subtitle ?subtitle ;
          thesis:author ?author ;
          thesis:date ?date ;
          thesis:abstract ?abstract ;
          thesis:keywords ?keywords .
}
"""
template = "thesis-main.tera"
output = "thesis.tex"

[[generation]]
name = "chapters"
query = """
PREFIX thesis: <http://ggen.dev/thesis#>

SELECT ?chapterNum ?chapterTitle ?chapterLabel
       ?sectionNum ?sectionTitle ?sectionContent ?sectionLabel
WHERE {
  ?chapter a thesis:Chapter ;
           thesis:orderIndex ?chapterNum ;
           thesis:title ?chapterTitle ;
           thesis:labelId ?chapterLabel ;
           thesis:hasSection ?section .

  ?section thesis:orderIndex ?sectionNum ;
           thesis:title ?sectionTitle ;
           thesis:content ?sectionContent ;
           thesis:labelId ?sectionLabel .
}
ORDER BY ?chapterNum ?sectionNum
"""
template = "chapter.tera"
output = "chapters.tex"

[[generation]]
name = "theorems"
query = """
PREFIX thesis: <http://ggen.dev/thesis#>

SELECT ?theoremType ?theoremName ?theoremLabel ?statement ?proof
WHERE {
  ?theorem a thesis:Theorem ;
           thesis:theoremType ?theoremType ;
           thesis:theoremName ?theoremName ;
           thesis:labelId ?theoremLabel ;
           thesis:statement ?statement ;
           thesis:proof ?proof .
}
ORDER BY ?theoremLabel
"""
template = "theorem.tera"
output = "theorems.tex"

[[generation]]
name = "equations"
query = """
PREFIX thesis: <http://ggen.dev/thesis#>

SELECT ?eqLabel ?eqContent ?eqDescription
WHERE {
  ?eq a thesis:Equation ;
      thesis:labelId ?eqLabel ;
      thesis:content ?eqContent ;
      thesis:description ?eqDescription .
}
ORDER BY ?eqLabel
"""
template = "equation.tera"
output = "equations.tex"

[[generation]]
name = "algorithms"
query = """
PREFIX thesis: <http://ggen.dev/thesis#>

SELECT ?algName ?algLabel ?algContent
WHERE {
  ?alg a thesis:Algorithm ;
       thesis:algorithmName ?algName ;
       thesis:labelId ?algLabel ;
       thesis:content ?algContent .
}
ORDER BY ?algLabel
"""
template = "algorithm.tera"
output = "algorithms.tex"

[[generation]]
name = "bibliography"
query = """
PREFIX thesis: <http://ggen.dev/thesis#>

SELECT ?citeKey ?entryType ?title ?author ?year ?venue ?url
WHERE {
  ?ref a thesis:Reference ;
       thesis:citeKey ?citeKey ;
       thesis:entryType ?entryType ;
       thesis:title ?title ;
       thesis:author ?author ;
       thesis:year ?year .

  OPTIONAL { ?ref thesis:venue ?venue }
  OPTIONAL { ?ref thesis:url ?url }
}
ORDER BY ?citeKey
"""
template = "bibliography.tera"
output = "references.bib"

# Meta-information for self-documentation
[meta]
thesis_about = "ggen v6 ontology-first software construction"
thesis_generated_by = "ggen v6 (meta-circular)"
proof_of_concept = "This configuration generates the thesis documenting the system"
philosophical_significance = "The documentation cannot drift from reality because it IS the reality projected through μ"
